/*! Shinobi v1.0.1001 Copyright (c) MDE. All rights reserved. */
function byteTable(values){for(var result=new Uint8Array(values.length),i=0;i<values.length;++i)result[i]=values[i];return result}function z80_init(){z80_init_tables()}function z80_init_tables(){for(var j,k,parity,i=0;i<256;i++){for(sz53_table[i]=i&168,j=i,parity=0,k=0;k<8;k++)parity^=j&1,j>>=1;parity_table[i]=parity?0:4;sz53p_table[i]=sz53_table[i]|parity_table[i]}sz53_table[0]|=64;sz53p_table[0]|=64}function z80_reset(){z80.a=z80.f=z80.b=z80.c=z80.d=z80.e=z80.h=z80.l=0;z80.a_=z80.f_=z80.b_=z80.c_=z80.d_=z80.e_=z80.h_=z80.l_=0;z80.ixh=z80.ixl=z80.iyh=z80.iyl=0;z80.i=z80.r=z80.r7=0;z80.sp=z80.pc=0;z80.iff1=z80.iff2=z80.im=0;z80.halted=0;z80.irq_pending=!1;z80.irq_suppress=!0}function z80_set_irq(asserted){z80.irq_pending=asserted;z80.irq_pending&&z80.iff1&&z80_interrupt()}function z80_interrupt(){var inttemp,pcl,pch;if(z80.iff1){z80.halted&&(z80.pc++,z80.pc&=65535,z80.halted=!1);z80.iff1=z80.iff2=0;z80.sp=z80.sp-1&65535;writebyte(z80.sp,z80.pc>>8);z80.sp=z80.sp-1&65535;writebyte(z80.sp,z80.pc&255);z80.r=z80.r+1&127;switch(z80.im){case 0:z80.pc=56;tstates+=12;break;case 1:z80.pc=56;tstates+=13;break;case 2:inttemp=256*z80.i+255;pcl=readbyte(inttemp++);inttemp&=4095;pch=readbyte(inttemp);z80.pc=pcl|pch<<8;tstates+=19;break;default:ui_error(UI_ERROR_ERROR,"Unknown interrupt mode %d",z80.im);fuse_abort()}}}function z80_instruction_hook(){}function z80_nmi(){z80.iff1=0;z80.sp=z80.sp-1&65535;writebyte(z80.sp,z80.pc>>8);z80.sp=z80.sp-1&65535;writebyte(z80.sp,z80.pc&255);tstates+=11;z80.pc=102}function sign_extend(v){return v<128?v:v-256}function z80_defaults(ops){for(var i=0;i<256;++i)ops[i]||(ops[i]=ops[256])}function z80_edxx(opcode){z80_ed_ops[opcode]()}function z80_cbxx(opcode){z80_cb_ops[opcode]()}function z80_ddxx(opcode){z80_dd_ops[opcode]()}function z80_fdxx(opcode){z80_fd_ops[opcode]()}function z80_ddfdcbxx(opcode,tempaddr){z80_ddfdcb_ops[opcode](tempaddr)}function z80_do_opcodes(cycleCallback){for(var oldTstates,opcode;tstates<event_next_event;)z80.irq_pending&&z80.iff1&&(z80.irq_suppress?z80.irq_suppress=!1:(z80.irq_suppress=!0,z80_interrupt())),oldTstates=tstates,tstates+=4,z80.r=z80.r+1&127,opcode=readbyte(z80.pc),z80_instruction_hook(z80.pc,opcode),z80.pc=z80.pc+1&65535,z80_base_ops[opcode](),cycleCallback(tstates-oldTstates)}function vdp_writeaddr(val){if(vdp_addr_state===0)vdp_addr_state=1,vdp_addr_latch=val;else{vdp_addr_state=0;switch(val>>>6){case 0:case 1:vdp_mode_select=0;vdp_addr=vdp_addr_latch|(val&63)<<8;break;case 2:var regnum=val&15;vdp_regs[regnum]=vdp_addr_latch;switch(regnum){case 7:update_border()}break;case 3:vdp_mode_select=1;vdp_addr=vdp_addr_latch&31}}}function vdp_writepalette(val){function expandBits(val){var v=val&3;return v|=v<<2,v|v<<4}var r=expandBits(val),g=expandBits(val>>>2),b=expandBits(val>>>4),pal_addr=vdp_addr&31;paletteR[pal_addr]=r;paletteG[pal_addr]=g;paletteB[pal_addr]=b;paletteRGB[pal_addr]=4278190080|b<<16|g<<8|r;palette[pal_addr]=val;vdp_addr=vdp_addr+1&16383;update_border()}function vdp_writeram(val){var i,effectiveBit,index;vram[vdp_addr]=val;var planarBase=vdp_addr&16380,twiddledBase=planarBase*2,val0=vram[planarBase],val1=vram[planarBase+1],val2=vram[planarBase+2],val3=vram[planarBase+3];for(i=0;i<8;++i)effectiveBit=7-i,index=val0>>>effectiveBit&1|(val1>>>effectiveBit&1)<<1|(val2>>>effectiveBit&1)<<2|(val3>>>effectiveBit&1)<<3,vramUntwiddled[twiddledBase+i]=index;vdp_addr=vdp_addr+1&16383}function vdp_writebyte(val){vdp_addr_state=0;vdp_mode_select===0?vdp_writeram(val):vdp_writepalette(val)}function vdp_readram(){var res=vram[vdp_addr];return vdp_addr=vdp_addr+1&16383,res}function vdp_readpalette(){var res=palette[vdp_addr&31];return vdp_addr=vdp_addr+1&16383,res}function vdp_readbyte(){return vdp_addr_state=0,vdp_mode_select===0?vdp_readram():vdp_readpalette()}function update_border(){var borderIndex=16+(vdp_regs[7]&15);paletteRGB[borderIndex]!==prev_border&&(prev_border=paletteRGB[borderIndex],borderColourCss="rgb("+paletteR[borderIndex]+","+paletteG[borderIndex]+","+paletteB[borderIndex]+")")}function vdp_readstatus(){var res=vdp_status;return vdp_status&=31,vdp_pending_hblank=!1,z80_set_irq(!1),vdp_addr_state=0,res}function findSprites(line){var spriteInfo=(vdp_regs[5]&126)<<7,active=[],spriteHeight=8,i,y;for(vdp_regs[1]&2&&(spriteHeight=16),i=0;i<64;i++){if(y=vram[spriteInfo+i],y===208)break;if(y>=240&&(y-=256),line>=y&&line<y+spriteHeight){if(active.length===8){vdp_status|=64;break}active.push([vram[spriteInfo+128+i*2],vram[spriteInfo+128+i*2+1],y])}}return active}function rasterize_background(lineAddr,pixelOffset,tileData,tileDef,transparent){var i,tileDefInc,paletteOffset,index;if(lineAddr=lineAddr|0,pixelOffset=pixelOffset|0,tileData=tileData|0,tileDef=(tileDef|0)*2,tileData&512?(tileDefInc=-1,tileDef+=7):tileDefInc=1,paletteOffset=tileData&2048?16:0,transparent&&paletteOffset===0)for(i=0;i<8;i++)index=vramUntwiddled[tileDef],tileDef+=tileDefInc,index!==0&&(fb32[lineAddr+pixelOffset]=paletteRGB[index]),pixelOffset=pixelOffset+1&255;else index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,tileDef+=tileDefInc,fb32[lineAddr+pixelOffset]=paletteRGB[index],pixelOffset=pixelOffset+1&255,index=vramUntwiddled[tileDef]+paletteOffset,fb32[lineAddr+pixelOffset]=paletteRGB[index]}function clear_background(lineAddr,pixelOffset){lineAddr=lineAddr|0;pixelOffset=pixelOffset|0;for(var rgb=paletteRGB[0],i=0;i<8;++i)fb32[lineAddr+pixelOffset]=rgb,pixelOffset=pixelOffset+1&255}function rasterize_background_line(lineAddr,pixelOffset,nameAddr,yMod){var yOffset,i;for(lineAddr=lineAddr|0,pixelOffset=pixelOffset|0,nameAddr=nameAddr|0,yOffset=(yMod|0)*4,i=0;i<32;i++){var tileData=vram[nameAddr+i*2]|vram[nameAddr+i*2+1]<<8,tileNum=tileData&511,tileDef=32*tileNum;tileDef+=tileData&1024?28-yOffset:yOffset;(tileData&4096)==0?rasterize_background(lineAddr,pixelOffset,tileData,tileDef,!1):clear_background(lineAddr,pixelOffset);pixelOffset=pixelOffset+8&255}}function rasterize_foreground_line(lineAddr,pixelOffset,nameAddr,yMod){var yOffset,i,tileData,tileNum,tileDef;for(lineAddr=lineAddr|0,pixelOffset=pixelOffset|0,nameAddr=nameAddr|0,yOffset=(yMod|0)*4,i=0;i<32;i++)(tileData=vram[nameAddr+i*2]|vram[nameAddr+i*2+1]<<8,(tileData&4096)!=0)&&(tileNum=tileData&511,tileDef=32*tileNum,tileDef+=tileData&1024?28-yOffset:yOffset,rasterize_background(lineAddr,i*8+pixelOffset&255,tileData,tileDef,!0))}function rasterize_sprites(line,lineAddr,pixelOffset,sprites){var spriteBase,i,k,sprite,offset,distToSprite;for(lineAddr=lineAddr|0,pixelOffset=pixelOffset|0,spriteBase=vdp_regs[6]&4?8192:0,i=0;i<256;++i){var xPos=i,spriteFoundThisX=!1,writtenTo=!1,minDistToNext=256;for(k=0;k<sprites.length;k++){if(sprite=sprites[k],offset=xPos-sprite[0],offset<0){distToSprite=-offset;distToSprite<minDistToNext&&(minDistToNext=distToSprite);continue}if(!(offset>=8)){spriteFoundThisX=!0;var spriteLine=line-sprite[2],spriteAddr=spriteBase+sprite[1]*32+spriteLine*4,untwiddledAddr=spriteAddr*2+offset,index=vramUntwiddled[untwiddledAddr];if(index!==0){if(writtenTo){vdp_status|=32;break}fb32[lineAddr+(pixelOffset+i-vdp_regs[8]&255)]=paletteRGB[16+index];writtenTo=!0}}}!spriteFoundThisX&&minDistToNext>1&&(i+=minDistToNext-1)}}function border_clear(lineAddr,count){var borderIndex,borderRGB,i;for(lineAddr=lineAddr|0,count=count|0,borderIndex=16+(vdp_regs[7]&15),borderRGB=paletteRGB[borderIndex],i=0;i<count;i++)fb32[lineAddr+i]=borderRGB}function rasterize_line(line){var lineAddr,effectiveLine;if(line=line|0,lineAddr=line*256|0,(vdp_regs[1]&64)==0){border_clear(lineAddr,256);return}effectiveLine=line+vdp_regs[9];effectiveLine>=224&&(effectiveLine-=224);var sprites=findSprites(line),pixelOffset=vdp_regs[0]&64&&line<16?0:vdp_regs[8],nameAddr=(vdp_regs[2]<<10&14336)+(effectiveLine>>>3)*64,yMod=effectiveLine&7;rasterize_background_line(lineAddr,pixelOffset,nameAddr,yMod);sprites.length&&rasterize_sprites(line,lineAddr,pixelOffset,sprites);rasterize_foreground_line(lineAddr,pixelOffset,nameAddr,yMod);vdp_regs[0]&32&&border_clear(lineAddr,8)}function vdp_frame_hook(){}function vdp_hblank(){var firstDisplayLine=70,pastEndDisplayLine=firstDisplayLine+192,endOfFrame=pastEndDisplayLine+48+3,needIrq;return vdp_current_line===firstDisplayLine&&(vdp_hblank_counter=vdp_regs[10]),vdp_current_line>=firstDisplayLine&&vdp_current_line<pastEndDisplayLine&&(rasterize_line(vdp_current_line-firstDisplayLine),--vdp_hblank_counter<0&&(vdp_hblank_counter=vdp_regs[10],vdp_pending_hblank=!0)),vdp_current_line++,needIrq=0,vdp_current_line===endOfFrame&&(vdp_current_line=0,vdp_status|=128,needIrq|=4,currentFrame++,vdp_frame_hook(currentFrame),borderColourCss&&(canvas.style.borderColor=borderColourCss,borderColourCss=null)),vdp_regs[1]&32&&vdp_status&128&&(needIrq|=2),vdp_regs[0]&16&&vdp_pending_hblank&&(needIrq|=1),needIrq}function vdp_init(){vram=new Uint8Array(16384);vramUntwiddled=new Uint8Array(32768);palette=new Uint8Array(32);paletteR=new Uint8Array(32);paletteG=new Uint8Array(32);paletteB=new Uint8Array(32);paletteRGB=new Uint32Array(32);vdp_regs=new Uint8Array(16);vdp_reset()}function vdp_reset(){for(var i=0;i<16384;i++)vram[i]=0;for(i=0;i<32;i++)paletteR[i]=paletteG[i]=paletteB[i]=paletteRGB[i]=palette[i]=0;for(i=0;i<16;i++)vdp_regs[i]=0;for(i=2;i<=5;i++)vdp_regs[i]=255;vdp_regs[6]=251;vdp_regs[10]=255;vdp_current_line=vdp_status=vdp_hblank_counter=0;vdp_mode_select=0}function vdp_get_line(){return vdp_current_line-64&255}function vdp_get_x(){return 0}function SoundChip(sampleRate,cpuHz){"use strict";function toneChannel(channel,out,offset,length){var i,reg=register[channel],vol=volume[channel];if(reg<=1){for(i=0;i<length;++i)out[i+offset]+=vol;return}for(i=0;i<length;++i)counter[channel]-=sampleDecrement,counter[channel]<0&&(counter[channel]+=reg,outputBit[channel]=!outputBit[channel]),out[i+offset]+=outputBit[channel]?vol:-vol}function shiftLfsrWhiteNoise(){var bit=lfsr&1^(lfsr&8)>>3;lfsr=lfsr>>1|bit<<15}function shiftLfsrPeriodicNoise(){lfsr>>=1;lfsr===0&&(lfsr=32768)}function noisePoked(){shiftLfsr=register[3]&4?shiftLfsrWhiteNoise:shiftLfsrPeriodicNoise;lfsr=32768}function addFor(channel){channel=channel|0;switch(register[channel]&3){case 0:return 16;case 1:return 32;case 2:return 64;case 3:return register[channel-1]}}function noiseChannel(channel,out,offset,length){for(var add=addFor(channel),vol=volume[channel],i=0;i<length;++i)counter[channel]-=sampleDecrement,counter[channel]<0&&(counter[channel]+=add,outputBit[channel]=!outputBit[channel],outputBit[channel]&&shiftLfsr()),out[i+offset]+=lfsr&1?vol:-vol}function generate(out,offset,length){offset=offset|0;length=length|0;for(var i=0;i<length;++i)out[i+offset]=0;if(enabled)for(i=0;i<4;++i)generators[i](i,out,offset,length)}function catchUp(){cyclesPending&&advance(cyclesPending);cyclesPending=0}function render(out,offset,length){var fromBuffer,i;for(catchUp(),fromBuffer=position>length?length:position,i=0;i<fromBuffer;++i)out[offset+i]=buffer[i];for(offset+=fromBuffer,length-=fromBuffer,i=fromBuffer;i<position;++i)buffer[i-fromBuffer]=buffer[i];position-=fromBuffer;length!==0&&generate(out,offset,length)}function advance(time){var num=time*samplesPerCycle+residual,rounded=num|0;(residual=num-rounded,position+rounded>=maxBufferSize&&(rounded=maxBufferSize-position),rounded!==0)&&(generate(buffer,position,rounded),position+=rounded)}function poke(value){var latchData,newVolume;catchUp();latchData=!!(value&128);latchData&&(latchedChannel=value>>5&3);(value&144)==144?(newVolume=value&15,volume[latchedChannel]=volumeTable[newVolume]):latchedChannel===3?(register[latchedChannel]=value&15,noisePoked()):register[latchedChannel]=latchData?register[latchedChannel]&-16|value&15:register[latchedChannel]&15|(value&63)<<4}for(var sampleDecrement=3546893/16/sampleRate,samplesPerCycle=sampleRate/cpuHz,register=[0,0,0,0],counter=[0,0,0,0],outputBit=[!1,!1,!1,!1],volume=[0,0,0,0],generators=[null,null,null,null],volumeTable=[],f=1,lfsr,shiftLfsr,enabled,cyclesPending,latchedChannel,i=0;i<16;++i)volumeTable[i]=f/generators.length,f*=Math.pow(10,-.1);volumeTable[15]=0;lfsr=0;shiftLfsr=shiftLfsrWhiteNoise;enabled=!0;cyclesPending=0;this.polltime=function(cycles){cyclesPending+=cycles};var residual=0,position=0,maxBufferSize=4096,buffer;for(buffer=typeof Float64Array!="undefined"?new Float64Array(maxBufferSize):new Float32Array(maxBufferSize),latchedChannel=0,i=0;i<3;++i)generators[i]=toneChannel;generators[3]=noiseChannel;this.render=render;this.poke=poke;this.reset=function(){for(var i=0;i<3;++i)counter[i]=volume[i]=register[i]=0;noisePoked();advance(1e5);cyclesPending=0};this.enable=function(e){enabled=e}}function cycleCallback(tstates){soundChip.polltime(tstates)}function line(){tstates-=tstatesPerHblank;z80_do_opcodes(cycleCallback);var vdp_status=vdp_hblank(),irq=!!(vdp_status&3);return(z80_set_irq(irq),vdp_status&4)?(paintScreen(),!0):!1}function start(){initialized&&!running&&(running=!0,audio_enable(!x.storage.noaudio),run())}function run(){var timeSinceLast,now,runner;initialized&&running&&((setTimeout(run,10),timeSinceLast=targetTimeout,now=Date.now(),timeSinceLast=now-lastFrame,timeSinceLast>pausedTimeout&&(timeSinceLast=targetTimeout),now-cyclet>999&&(now-cyclet-1e3<targetTimeout&&x.text("#game-fps",cycles),cycles=0,cyclet=now),timeSinceLast<targetTimeout)||(lastFrame=now-timeSinceLast%targetTimeout,cycles++,runner=function(){if(running){for(var i=0;i<linesPerYield;++i)if(line())return;running&&setTimeout(runner,0)}},runner()))}function stop(){initialized&&running&&(running=!1,audio_enable(!1))}function reset(){miracle_reset()}function pumpAudio(event){var outBuffer=event.outputBuffer,chan=outBuffer.getChannelData(0);soundChip.render(chan,0,chan.length)}function audio_init(){if(typeof AudioContext!="undefined")audioContext=new AudioContext;else if(typeof webkitAudioContext!="undefined")audioContext=new webkitAudioContext;else{x.write("Unable to render audio");soundChip=new SoundChip(1e4,cpuHz);return}var audioNode=audioContext.createScriptProcessor(4096,0,1);audioNode.onaudioprocess=pumpAudio;audioNode.connect(audioContext.destination,0,0);soundChip=new SoundChip(audioContext.sampleRate,cpuHz)}function audio_enable(enable){x.storage.noaudio=!enable;soundChip.enable(enable);audioContext&&(enable&&audioContext.state==="suspended"?audioContext.resume&&audioContext.resume():enable||audioContext.state==="suspended"||audioContext.suspend&&audioContext.suspend())}function audio_reset(){soundChip.reset()}function audio_toggle(){audio_enable(x.storage.noaudio)}function miracle_init(){z80_init();vdp_init();audio_init();ram=new Uint8Array(8192);cartridgeRam=new Uint8Array(32768);pages=new Uint8Array(3);miracle_reset();canvas=document.getElementById("game-view");ctx=canvas.getContext("2d");ctx.getImageData?(imageData=ctx.getImageData(0,0,256,192),fb8=imageData.data,fb32=new Uint32Array(fb8.buffer)):alert("upgrade your browser, dude");document.onkeydown=keyDown;document.onkeyup=keyUp;document.onkeypress=keyPress;initialized=!0}function miracle_reset(){for(var i=0;i<8192;i++)ram[i]=0;for(i=0;i<32768;i++)cartridgeRam[i]=0;for(i=0;i<3;i++)pages[i]=i;ramSelectRegister=0;inputMode=7;z80_reset();vdp_reset();audio_reset()}function keyCode(evt){return evt.which||evt.charCode||evt.keyCode}function keyDown(evt){if(running){var key=keys[keyCode(evt)];if(key&&(joystick&=~key,!evt.metaKey)){evt.preventDefault();return}switch(evt.keyCode){case 67:loadNextRom();break;case 70:x.app.toggleFullScreen();break;case 3:case 19:case 80:z80_nmi();break;case 85:audio_toggle()}}}function keyUp(evt){if(running){var key=keys[keyCode(evt)];key&&(joystick|=key,evt.metaKey||evt.preventDefault())}}function keyPress(evt){running&&(evt.metaKey||evt.preventDefault())}function paintScreen(){ctx.putImageData(imageData,0,0)}function loadRom(name,rom){var numRomBanks=rom.length/16384,i,j,serial;for(console.log("Loading rom of "+numRomBanks+" banks"),i=0;i<numRomBanks;i++)for(romBanks[i]=new Uint8Array(16384),j=0;j<16384;j++)romBanks[i][j]=rom.charCodeAt(i*16384+j);for(i=0;i<3;i++)pages[i]=i%numRomBanks;romPageMask=numRomBanks-1|0;serial=romBanks[1][16380]<<8|romBanks[1][16381];console.log("Running "+name+" serial 0x"+hexword(serial))}function hexbyte(value){return(value>>4&15).toString(16)+(value&15).toString(16)}function hexword(value){return(value>>12&15).toString(16)+(value>>8&15).toString(16)+(value>>4&15).toString(16)+(value&15).toString(16)}function virtualAddress(address){function romAddr(bank,addr){return"rom"+bank.toString(16)+"_"+hexword(addr)}if(address<1024)return romAddr(0,address);if(address<16384)return romAddr(pages[0],address);if(address<32768)return romAddr(pages[1],address-16384);if(address<49152)return(ramSelectRegister&12)==8?"crm_"+hexword(address-32768):(ramSelectRegister&12)==12?"crm_"+hexword(address-16384):romAddr(pages[2],address-32768);if(address<57344)return"ram+"+hexword(address-49152);if(address<65532)return"ram_"+hexword(address-57344);switch(address){case 65532:return"rsr";case 65533:return"rpr_0";case 65534:return"rpr_1";case 65535:return"rpr_2"}return"unk_"+hexword(address)}function readbyte(address){address=address|0;var page=address>>>14&3;address&=16383;switch(page){case 0:return address<1024?romBanks[0][address]:romBanks[pages[0]][address];case 1:return romBanks[pages[1]][address];case 2:switch(ramSelectRegister&12){case 8:return cartridgeRam[address];case 12:return cartridgeRam[address+16384]}return romBanks[pages[2]][address];case 3:return ram[address&8191]}}function writebyte(address,value){if(address=address|0,value=value|0,address>=65532)switch(address){case 65532:ramSelectRegister=value;break;case 65533:value&=romPageMask;pages[0]=value;break;case 65534:value&=romPageMask;pages[1]=value;break;case 65535:value&=romPageMask;pages[2]=value;break;default:console.log("zoiks")}(address-=49152,address<0)||(ram[address&8191]=value)}function readport(addr){addr&=255;switch(addr){case 126:return vdp_get_line();case 127:return vdp_get_x();case 220:case 192:return joystick&255;case 221:case 193:return joystick>>8&255;case 190:return vdp_readbyte();case 189:case 191:return vdp_readstatus();case 222:return 255;case 223:return 255;case 242:return 0;default:return console.log("IO port "+hexbyte(addr)+"?"),255}}function writeport(addr,val){val=val|0;addr&=255;switch(addr){case 63:var natbit=val>>5&1;(val&1)==0&&(natbit=1);joystick=joystick&-16385|natbit<<14;natbit=val>>7&1;(val&4)==0&&(natbit=1);joystick=joystick&-32769|natbit<<15;break;case 126:case 127:soundChip.poke(val);break;case 189:case 191:vdp_writeaddr(val);break;case 190:vdp_writebyte(val);break;case 222:inputMode=val;break;case 223:break;case 240:case 241:case 242:break;case 62:break;default:console.log("IO port "+hexbyte(addr)+" = "+val)}}function loadRomData(rom){var path,request;x.write("Loading "+rom.title);path="roms/"+rom.file;console.log("Loading rom data from "+path);request=new XMLHttpRequest;request.onload=function(){request.readyState===4&&(request.status===200?(x.write("Rom loaded"),loadRom(rom.title,request.response),start()):x.write("Rom loading error: "+request.statusText))};request.onerror=function(){x.write("Rom loading error: "+request.statusText)};request.open("GET",path,!0);request.overrideMimeType("text/plain; charset=x-user-defined");request.send()}function go(){miracle_init();miracle_reset();loadRomData(getLastRom())}function getLastRom(){return typeof localStorage!="undefined"&&localStorage.rom?(currentRom=localStorage.rom,roms[currentRom]):roms[0]}function loadNextRom(){if(miracle_reset(),currentRom=++currentRom%roms.length,typeof localStorage!="undefined")try{localStorage.rom=currentRom}catch(err){}loadRomData(roms[currentRom])}var VERSION="Shinobi v1.0.1001",global=window,z80_base_ops,z80_ed_ops,z80_cb_ops,z80_dd_ops,z80_fd_ops,z80_ddfdcb_ops,prev_border,borderColourCss,currentFrame,audioContext,keys,running,currentRom;global.x={};global.strings={PlayerKeys:'Player1: <span class="key">W<\/span> <span class="key">A<\/span> <span class="key">S<\/span> <span class="key">D<\/span>/<span class="key">ARROWS<\/span> to move, <span class="key">SPACE<\/span>/<span class="key">Z<\/span> for fire 1, <span class="key">ENTER<\/span>/<span class="key">X<\/span> for fire 2.',ConsoleKeys:'Console: <span class="key">PAUSE<\/span>/<span class="key">P<\/span> for Pause button, <span class="key">C<\/span> changes game, <span class="key">R<\/span> resets, <span class="key">U<\/span> audio, <span class="key">F<\/span> full-screen.'},function(){"use strict";var x=global.x,t0,acc;x.versions=["m.JS core/1"];x.noop=function(){};t0=+new Date;x.dt=function(){return x.tc()-t0};x.tc=function(){return+new Date};"console"in window||(window.console={log:x.noop,assert:x.noop,trace:x.noop,debug:x.noop,info:x.noop,warn:x.noop,error:x.noop});x.E={ARG:"invalid argument",BROWSER:"no browser support",CLASSCTOR:"class constructor expected",FUNCTION:"function expected",INSTANCEOF:"instance of a class expected",SINGLEINST:"only one instance is allowed"};x.isDefined=function(o){return typeof o!="undefined"};x.isFunction=function(o){return typeof o=="function"};x.isNumber=function(o){return typeof o=="number"};x.isObject=function(o){return typeof o=="object"};x.isString=function(o){return typeof o=="string"||o instanceof String};x.isArray=function(o){return o instanceof Array};x.isCollection=function(o){return x.isArray(o)||o&&!x.isFunction(o)&&!x.isWindow(o)&&!x.isString(o)&&x.isNumber(o.length)};x.isWindow=function(o){return window.Window&&o instanceof Window||o&&x.isFunction(o.Object)};x.isFunction(Object.create)||(Object.create=function(){var Creator=function(){};return function(prototype){if(arguments.length>1)throw Error(x.E.ARG+": argument 2 not supported");if(!x.isObject(prototype))throw TypeError(": prototype");Creator.prototype=prototype;var instance=new Creator;return Creator.prototype=null,instance}}());x.isFunction(Function.prototype.bind)||(Function.prototype.bind=function(boundThis){if(!x.isFunction(this))throw TypeError(x.E.FUNCTION);var args=Array.prototype.slice.call(arguments,1),Creator=function(){},fToBind=this,fBound=function(){return fToBind.apply(this instanceof Creator?this:boundThis,args.concat(Array.prototype.slice.call(arguments)))};return Creator.prototype=this.prototype||null,fBound.prototype=new Creator,Creator.prototype=null,fBound});acc=0;x.createClass=function(ns,name,ctor,designer){function ClassCtor(){if(!(this instanceof ClassCtor))return new ClassCtor;x.isFunction(ctor)&&ctor.apply(this,arguments)}ns=ns||window;name=name||"<Anonymous_"+ ++acc+">";ns[name]=ClassCtor;var proto=ClassCtor.prototype;return proto.className=name,proto.toString=function(){return"[object "+name+"]"},x.isFunction(designer)&&designer(proto),ClassCtor};x.extendClass=function(BaseClassCtor,ns,name,ctor,designer){function ClassCtor(){if(!(this instanceof ClassCtor))return new ClassCtor;BaseClassCtor.apply(this,arguments);x.isFunction(ctor)&&ctor.apply(this,arguments)}if(!x.isFunction(BaseClassCtor))throw Error(x.E.CLASSCTOR);ns=ns||window;name=name||"Anonymous_"+ ++acc;ClassCtor.prototype=Object.create(BaseClassCtor.prototype);ns[name]=ClassCtor.prototype.constructor=ClassCtor;var base=BaseClassCtor.prototype,proto=ClassCtor.prototype;return proto.className=name,proto.toString=function(){return"[object "+name+"]"},x.isFunction(designer)&&designer(proto,base),ClassCtor};x.event=function(){return new x.Delegate};x.property=function(initValue,onchange,onchanged){var holder=null;return x.isDefined(initValue)&&(holder=initValue),function(value){return x.isDefined(value)&&holder!==value&&(!x.isFunction(onchange)||onchange(value)!==!1)&&(holder=value,x.isFunction(onchange)&&onchanged(value)),holder}};x.createClass(x,"Delegate",function(){this._fList=[]},function(proto){proto.add=function(f){if(!x.isFunction(f))throw TypeError(x.E.FUNCTION);this._fList.push(f)};proto.invoke=function(){for(var len=this._fList.length;len--;)this._fList[len].apply(this,arguments)};proto.length=function(){return this._fList.length};proto.remove=function(f){if(!x.isFunction(f))throw TypeError(x.E.FUNCTION);for(var len=this._fList.length;len--;)this._fList[len]===f&&this._fList.splice(len,1)}})}(),function(){"use strict";var x=global.x,DISPLAYHIDE,DISPLAYSHOW,textMethod,commonElements,covers;x.versions[0]+=" core.dom/1";x.all=function(elements,iterator,iteratorArgs){var ls,i;if(!elements)throw Error(x.E.ARG+": elements");if(x.isString(elements)&&!x.isFunction(document.querySelectorAll))throw Error(x.E.BROWSER);if(ls=x.isString(elements)?document.querySelectorAll(elements):x.isArray(elements)?elements:[elements],arguments.length>1){if(!x.isFunction(iterator))throw TypeError(x.E.FUNCTION);for(i=0;i<ls.length;i++)iterator.call(this,ls[i],iteratorArgs)}else return ls};DISPLAYHIDE="none";DISPLAYSHOW="block";x.display=function(elements,show){x.all(elements,function(l,value){l.style.display=value},show===!1?DISPLAYHIDE:show||DISPLAYSHOW)};x.displayLayout=function(show){x.display(".x-layout",show)};x.html=function(elements,html){x.all(elements,function(l){l.innerHTML=html})};textMethod="textContent"in document?"textContent":"innerText"in document?"innerText":"innerHTML";x.text=function(elements,text){x.all(elements,function(l){l[textMethod]=text})};commonElements=[];covers=0;x.cover=function(content){if(!commonElements.cover){var l=document.createElement("div");l.id="x-cover";l.style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;right:0;bottom:0;z-Index:10000;";document.body.appendChild(l);commonElements.cover=l}covers++;commonElements.cover.innerHTML=content||"";commonElements.cover.style.display=DISPLAYSHOW};x.uncover=function(){covers>0&&--covers==0&&(commonElements.cover.style.display=DISPLAYHIDE)};x.write=function(text,time){var l,l1,l2;commonElements.writeArea||(l=document.createElement("div"),l.style.cssText="position:absolute;left:0;top:0;pointer-events:none;z-Index:11000;",document.body.appendChild(l),commonElements.writeArea=l);l1=document.createElement("pre");l2=document.createElement("span");l2.style.cssText="background-color:#333333;background-color:rgba(0,0,0,0.50);color:white";l2.innerHTML=text;l1.appendChild(l2);commonElements.writeArea.appendChild(l1);setTimeout(function(){commonElements.writeArea.removeChild(l1)},time*1e3||3e3)}}(),function(){"use strict";function oninit(){document.body&&initDelegate&&(initDelegate.invoke(),initDelegate=null)}function onload(){oninit();loadDelegate&&(loadDelegate.invoke(),loadDelegate=null)}function onreadystate(){if(document.readyState==="interactive")oninit();else if(document.readyState==="complete")return onload(),!0}var x=global.x,initDelegate,loadDelegate,click,press,release;x.versions[0]+=" core.dom.compatibility/1";x.addEventHandler=window.addEventListener?function(elements,eventName,handler,capture){x.all(elements,function(l){l.addEventListener(eventName,handler,capture||!1)})}:function(elements,eventName,handler){x.all(elements,function(l){l.attachEvent("on"+eventName,handler)})};initDelegate=new x.Delegate;loadDelegate=new x.Delegate;onreadystate()||("DOMContentLoaded"in document?(x.addEventHandler(document,"DOMContentLoaded",oninit),x.addEventHandler(window,"load",onload)):x.addEventHandler(document,"readystatechange",onreadystate));x.addContentLoadHandler=function(handler){initDelegate?initDelegate.add(handler):handler()};x.addPageLoadHandler=function(handler){loadDelegate?loadDelegate.add(handler):handler()};"ontouchstart"in window?(press="touchstart",click=release="touchend"):"onpointerdown"in window?(press="pointerdown",click=release="pointerup"):(click="click",press="mousedown",release="mouseup");x.addClickHandler=function(element,clickHandler,capture){x.addEventHandler(element,click,clickHandler,capture)};x.addPressHandler=function(element,pressHandler,capture){x.addEventHandler(element,press,pressHandler,{passive:!0,capture:capture})};x.addReleaseHandler=function(element,releaseHandler,capture){x.addEventHandler(element,release,releaseHandler,{passive:!0,capture:capture})};x.addPressReleaseHandlers=function(element,pressHandler,releaseHandler,capture){x.addPressHandler(element,pressHandler,capture);x.addReleaseHandler(element,releaseHandler,capture)};x.cancelEvent=function(e){return e=e||window.event,e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation&&e.stopPropagation(),x.isFunction(e.preventDefault)&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,!1}}(),function(){"use strict";function initialize(){(initialized=x.app.initialize()===!1?!1:!0,initialized)&&(window.onerror=function(msg,url,line,column,error){var info=error&&error.stack?error.stack:"Error : "+(msg||"unknown")+(url&&line&&column?"\n   at "+url+":"+line+":"+column:"");x.app.critical(info)},"onvisibilitychange"in window?x.addEventHandler(document,"visibility",visibility,!1):(x.addEventHandler(window,"blur",suspend,!1),x.addEventHandler(window,"focus",resume,!1)),x.addEventHandler(window,"keydown",filter,!0),x.addEventHandler(window,"keyup",filter,!0),x.addEventHandler(window,"resize",resizing,!0),resize(),document.hasFocus()||suspend())}function go(){initialized&&x.app.go()}function filter(e){if((e=e||window.event,e)&&x.app.trapKeys()){var keyCode=e.which||e.charCode||e.keyCode;if(keyCode===116||keyCode===82&&e.ctrlKey||keyCode===8&&!elementIsEditable(e.target))return x.cancelEvent(e)}}function elementIsEditable(l){return l&&!l.disabled&&!l.readOnly&&["INPUT","SELECT","TEXTAREA"].indexOf(l.tagName)>-1}function resizing(){pendingSize&&clearTimeout(pendingSize);pendingSize=setTimeout(resize,66)}function resize(){var w=document.body.clientWidth||window.innerWidth,h=document.body.clientHeight||window.innerHeight;(vw!==w||vh!==h)&&(initialized&&x.app.layout(vw=w,vh=h),setTimeout(function(){window.scrollTo(0,1)},33))}function resume(){suspended||suspend();suspended=!1;x.write("resume");initialized&&x.app.resume()}function suspend(){suspended||(suspended=!0,x.write("suspend"),initialized&&x.app.suspend())}function visibility(){x.write("visibility "+document.visibilityState);document.visibilityState==="hidden"?suspend():resume()}var x=global.x;x.versions[0]+=" core.app/1";document.ondragstart=x.cancelEvent;document.ondrop=x.cancelEvent;x.createClass(x,"App",function(){if(x.app)throw Error(x.E.SINGLEINST+": "+this.className);x.app=this;x.addContentLoadHandler(initialize);x.addPageLoadHandler(go)},function(proto){proto.blue=function(text){if(!initialized)return document.body.innerHTML='<pre id="x-blue">'+text+"<\/pre>",!1;x.cover('<pre id="x-error">'+text+"<\/pre>")};proto.critical=function(info){x.cover('<pre id="x-error"><h1>:{ CRASH!<\/h1>\n'+info+"\n"+x.versions.join("\n")+"<\/pre>")};proto.initialize=function(){};proto.go=function(){};proto.layout=function(){};proto.resume=function(){};proto.suspend=function(){};proto.trapKeys=x.property(!1);proto.lockHistory=function(locked){"history"in window&&x.isFunction(history.pushState)&&(locked!==!1?"onpopstate"in window&&(window.onpopstate=null):(history.state!==this&&history.pushState(this,null,location.href),"onpopstate"in window&&(window.onpopstate=function(){history.go(1)})))}});var initialized=!1,vw=-1,vh=-1,suspended=!1,pendingSize=0}(),function(){"use strict";var x=global.x;x.versions[0]+=" core.game/1";x.extendClass(x.App,x,"Game",function(){x.addEventHandler([document,window],"contextmenu",x.cancelEvent);this.lockHistory();this.trapKeys(!0)},function(proto){var l=document.documentElement,rfs,efs,fse;l.requestFullscreen?(rfs="requestFullscreen",efs="exitFullscreen",fse="fullscreenElement"):l.mozRequestFullScreen?(rfs="mozRequestFullScreen",efs="mozExitFullScreen",fse="mozFullScreenElement"):l.webkitRequestFullscreen?(rfs="webkitRequestFullscreen",efs="webkitExitFullscreen",fse="webkitFullscreenElement"):l.msRequestFullscreen&&(rfs="msRequestFullscreen",efs="msExitFullscreen",fse="msFullscreenElement");proto.fullScreen=function(enter){enter!==!1?rfs&&l[rfs]():efs&&document[efs]()};proto.toggleFullScreen=function(){fse&&this.fullScreen(!document[fse])};proto.firstInput=null;proto.onFirstInput=function(element,methods,handler){if(!x.isFunction(handler))throw TypeError(x.E.FUNCTION);var game=this;methods.keyboard&&document.addEventListener("keydown",function fk(e){return document.removeEventListener("keydown",fk,!0),game.firstInput||(game.firstInput="keyboard",handler({keyboard:!0})),x.cancelEvent(e)},!0);methods.mouse&&element.addEventListener("mousedown",function fm(e){return element.removeEventListener("mousedown",fm),game.firstInput||(game.firstInput="mouse",handler({mouse:!0})),x.cancelEvent(e)});methods.touch&&element.addEventListener("touchstart",function ft(e){return element.removeEventListener("touchstart",ft),game.firstInput||(game.firstInput="touch",handler({touch:!0})),x.cancelEvent(e)},{passive:!0})}})}(),function(){"use strict";function test(storage){var data=x.tc(),pass=!1;try{storage.test=data;pass=storage.test===data;storage.removeItem("test")}catch(err){pass=!1}}var x=global.x;x.versions[0]+=" core.storage/1";x.session=(x.haveSession="sessionStorage"in window&&test(sessionStorage)||!1)?sessionStorage:{};x.storage=(x.haveStorage="localStorage"in window&&test(localStorage)||!1)?localStorage:{}}();var halfcarry_add_table=byteTable([0,16,16,16,0,0,0,16]),halfcarry_sub_table=byteTable([0,0,16,0,16,0,16,16]),overflow_add_table=byteTable([0,0,0,4,4,0,0,0]),overflow_sub_table=byteTable([0,4,0,0,0,0,4,0]),sz53_table=new Uint8Array(256),parity_table=new Uint8Array(256),sz53p_table=new Uint8Array(256),z80={a:0,f:0,b:0,c:0,d:0,e:0,h:0,l:0,a_:0,f_:0,b_:0,c_:0,d_:0,e_:0,h_:0,l_:0,ixh:0,ixl:0,iyh:0,iyl:0,i:0,r:0,r7:0,sp:0,pc:0,iff1:0,iff2:0,im:0,halted:!1,irq_pending:!1,irq_suppress:!1};z80_base_ops=function(){var ops=[];return ops[0]=function(){},ops[1]=function(){tstates+=6;z80.c=readbyte(z80.pc++);z80.pc&=65535;z80.b=readbyte(z80.pc++);z80.pc&=65535},ops[2]=function(){tstates+=3;writebyte(z80.c|z80.b<<8,z80.a)},ops[3]=function(){tstates+=2;var wordtemp=(z80.c|z80.b<<8)+1&65535;z80.b=wordtemp>>8;z80.c=wordtemp&255},ops[4]=function(){z80.b=z80.b+1&255;z80.f=z80.f&1|(z80.b==128?4:0)|(z80.b&15?0:16)|sz53_table[z80.b]},ops[5]=function(){z80.f=z80.f&1|(z80.b&15?0:16)|2;z80.b=z80.b-1&255;z80.f|=(z80.b==127?4:0)|sz53_table[z80.b]},ops[6]=function(){tstates+=3;z80.b=readbyte(z80.pc++);z80.pc&=65535},ops[7]=function(){z80.a=(z80.a&127)<<1|z80.a>>7;z80.f=z80.f&196|z80.a&41},ops[8]=function(){var olda=z80.a,oldf=z80.f;z80.a=z80.a_;z80.f=z80.f_;z80.a_=olda;z80.f_=oldf},ops[9]=function(){var add16temp=(z80.l|z80.h<<8)+(z80.c|z80.b<<8),lookup=((z80.l|z80.h<<8)&2048)>>11|((z80.c|z80.b<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[10]=function(){tstates+=3;z80.a=readbyte(z80.c|z80.b<<8)},ops[11]=function(){tstates+=2;var wordtemp=(z80.c|z80.b<<8)-1&65535;z80.b=wordtemp>>8;z80.c=wordtemp&255},ops[12]=function(){z80.c=z80.c+1&255;z80.f=z80.f&1|(z80.c==128?4:0)|(z80.c&15?0:16)|sz53_table[z80.c]},ops[13]=function(){z80.f=z80.f&1|(z80.c&15?0:16)|2;z80.c=z80.c-1&255;z80.f|=(z80.c==127?4:0)|sz53_table[z80.c]},ops[14]=function(){tstates+=3;z80.c=readbyte(z80.pc++);z80.pc&=65535},ops[15]=function(){z80.f=z80.f&196|z80.a&1;z80.a=z80.a>>1|(z80.a&1)<<7;z80.f|=z80.a&40},ops[16]=function(){tstates+=4;z80.b=z80.b-1&255;z80.b&&(tstates+=5,z80.pc+=sign_extend(readbyte(z80.pc)),z80.pc&=65535);z80.pc++;z80.pc&=65535},ops[17]=function(){tstates+=6;z80.e=readbyte(z80.pc++);z80.pc&=65535;z80.d=readbyte(z80.pc++);z80.pc&=65535},ops[18]=function(){tstates+=3;writebyte(z80.e|z80.d<<8,z80.a)},ops[19]=function(){tstates+=2;var wordtemp=(z80.e|z80.d<<8)+1&65535;z80.d=wordtemp>>8;z80.e=wordtemp&255},ops[20]=function(){z80.d=z80.d+1&255;z80.f=z80.f&1|(z80.d==128?4:0)|(z80.d&15?0:16)|sz53_table[z80.d]},ops[21]=function(){z80.f=z80.f&1|(z80.d&15?0:16)|2;z80.d=z80.d-1&255;z80.f|=(z80.d==127?4:0)|sz53_table[z80.d]},ops[22]=function(){tstates+=3;z80.d=readbyte(z80.pc++);z80.pc&=65535},ops[23]=function(){var bytetemp=z80.a;z80.a=(z80.a&127)<<1|z80.f&1;z80.f=z80.f&196|z80.a&40|bytetemp>>7},ops[24]=function(){tstates+=3;tstates+=5;z80.pc+=sign_extend(readbyte(z80.pc));z80.pc&=65535;z80.pc++;z80.pc&=65535},ops[25]=function(){var add16temp=(z80.l|z80.h<<8)+(z80.e|z80.d<<8),lookup=((z80.l|z80.h<<8)&2048)>>11|((z80.e|z80.d<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[26]=function(){tstates+=3;z80.a=readbyte(z80.e|z80.d<<8)},ops[27]=function(){tstates+=2;var wordtemp=(z80.e|z80.d<<8)-1&65535;z80.d=wordtemp>>8;z80.e=wordtemp&255},ops[28]=function(){z80.e=z80.e+1&255;z80.f=z80.f&1|(z80.e==128?4:0)|(z80.e&15?0:16)|sz53_table[z80.e]},ops[29]=function(){z80.f=z80.f&1|(z80.e&15?0:16)|2;z80.e=z80.e-1&255;z80.f|=(z80.e==127?4:0)|sz53_table[z80.e]},ops[30]=function(){tstates+=3;z80.e=readbyte(z80.pc++);z80.pc&=65535},ops[31]=function(){var bytetemp=z80.a;z80.a=z80.a>>1|(z80.f&1)<<7;z80.f=z80.f&196|z80.a&40|bytetemp&1},ops[32]=function(){tstates+=3;z80.f&64||(tstates+=5,z80.pc+=sign_extend(readbyte(z80.pc)),z80.pc&=65535);z80.pc++;z80.pc&=65535},ops[33]=function(){tstates+=6;z80.l=readbyte(z80.pc++);z80.pc&=65535;z80.h=readbyte(z80.pc++);z80.pc&=65535},ops[34]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.l);ldtemp&=65535;writebyte(ldtemp,z80.h)},ops[35]=function(){tstates+=2;var wordtemp=(z80.l|z80.h<<8)+1&65535;z80.h=wordtemp>>8;z80.l=wordtemp&255},ops[36]=function(){z80.h=z80.h+1&255;z80.f=z80.f&1|(z80.h==128?4:0)|(z80.h&15?0:16)|sz53_table[z80.h]},ops[37]=function(){z80.f=z80.f&1|(z80.h&15?0:16)|2;z80.h=z80.h-1&255;z80.f|=(z80.h==127?4:0)|sz53_table[z80.h]},ops[38]=function(){tstates+=3;z80.h=readbyte(z80.pc++);z80.pc&=65535},ops[39]=function(){var add=0,carry=z80.f&1,subtemp,addtemp,lookup;(z80.f&16||(z80.a&15)>9)&&(add=6);(carry||z80.a>153)&&(add|=96);z80.a>153&&(carry=1);z80.f&2?(subtemp=z80.a-add,lookup=(z80.a&136)>>3|(add&136)>>2|(subtemp&136)>>1,z80.a=subtemp&255,z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]):(addtemp=z80.a+add,lookup=(z80.a&136)>>3|(add&136)>>2|(addtemp&136)>>1,z80.a=addtemp&255,z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]);z80.f=z80.f&-6|carry|parity_table[z80.a]},ops[40]=function(){tstates+=3;z80.f&64&&(tstates+=5,z80.pc+=sign_extend(readbyte(z80.pc)),z80.pc&=65535);z80.pc++;z80.pc&=65535},ops[41]=function(){var add16temp=(z80.l|z80.h<<8)+(z80.l|z80.h<<8),lookup=((z80.l|z80.h<<8)&2048)>>11|((z80.l|z80.h<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[42]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.l=readbyte(ldtemp++);ldtemp&=65535;z80.h=readbyte(ldtemp)},ops[43]=function(){tstates+=2;var wordtemp=(z80.l|z80.h<<8)-1&65535;z80.h=wordtemp>>8;z80.l=wordtemp&255},ops[44]=function(){z80.l=z80.l+1&255;z80.f=z80.f&1|(z80.l==128?4:0)|(z80.l&15?0:16)|sz53_table[z80.l]},ops[45]=function(){z80.f=z80.f&1|(z80.l&15?0:16)|2;z80.l=z80.l-1&255;z80.f|=(z80.l==127?4:0)|sz53_table[z80.l]},ops[46]=function(){tstates+=3;z80.l=readbyte(z80.pc++);z80.pc&=65535},ops[47]=function(){z80.a^=255;z80.f=z80.f&197|z80.a&40|18},ops[48]=function(){tstates+=3;z80.f&1||(tstates+=5,z80.pc+=sign_extend(readbyte(z80.pc)),z80.pc&=65535);z80.pc++;z80.pc&=65535},ops[49]=function(){var splow,sphigh;tstates+=6;splow=readbyte(z80.pc++);z80.pc&=65535;sphigh=readbyte(z80.pc++);z80.sp=splow|sphigh<<8;z80.pc&=65535},ops[50]=function(){tstates+=3;var wordtemp=readbyte(z80.pc++);z80.pc&=65535;tstates+=6;wordtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(wordtemp,z80.a)},ops[51]=function(){tstates+=2;z80.sp=z80.sp+1&65535},ops[52]=function(){tstates+=7;var bytetemp=readbyte(z80.l|z80.h<<8);bytetemp=bytetemp+1&255;z80.f=z80.f&1|(bytetemp==128?4:0)|(bytetemp&15?0:16)|sz53_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[53]=function(){tstates+=7;var bytetemp=readbyte(z80.l|z80.h<<8);z80.f=z80.f&1|(bytetemp&15?0:16)|2;bytetemp=bytetemp-1&255;z80.f|=(bytetemp==127?4:0)|sz53_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[54]=function(){tstates+=6;writebyte(z80.l|z80.h<<8,readbyte(z80.pc++));z80.pc&=65535},ops[55]=function(){z80.f=z80.f&196|z80.a&40|1},ops[56]=function(){tstates+=3;z80.f&1&&(tstates+=5,z80.pc+=sign_extend(readbyte(z80.pc)),z80.pc&=65535);z80.pc++;z80.pc&=65535},ops[57]=function(){var add16temp=(z80.l|z80.h<<8)+z80.sp,lookup=((z80.l|z80.h<<8)&2048)>>11|(z80.sp&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[58]=function(){var wordtemp;tstates+=9;wordtemp=readbyte(z80.pc++);z80.pc&=65535;wordtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.a=readbyte(wordtemp)},ops[59]=function(){tstates+=2;z80.sp=z80.sp-1&65535},ops[60]=function(){z80.a=z80.a+1&255;z80.f=z80.f&1|(z80.a==128?4:0)|(z80.a&15?0:16)|sz53_table[z80.a]},ops[61]=function(){z80.f=z80.f&1|(z80.a&15?0:16)|2;z80.a=z80.a-1&255;z80.f|=(z80.a==127?4:0)|sz53_table[z80.a]},ops[62]=function(){tstates+=3;z80.a=readbyte(z80.pc++);z80.pc&=65535},ops[63]=function(){z80.f=z80.f&196|(z80.f&1?16:1)|z80.a&40},ops[64]=function(){},ops[65]=function(){z80.b=z80.c},ops[66]=function(){z80.b=z80.d},ops[67]=function(){z80.b=z80.e},ops[68]=function(){z80.b=z80.h},ops[69]=function(){z80.b=z80.l},ops[70]=function(){tstates+=3;z80.b=readbyte(z80.l|z80.h<<8)},ops[71]=function(){z80.b=z80.a},ops[72]=function(){z80.c=z80.b},ops[73]=function(){},ops[74]=function(){z80.c=z80.d},ops[75]=function(){z80.c=z80.e},ops[76]=function(){z80.c=z80.h},ops[77]=function(){z80.c=z80.l},ops[78]=function(){tstates+=3;z80.c=readbyte(z80.l|z80.h<<8)},ops[79]=function(){z80.c=z80.a},ops[80]=function(){z80.d=z80.b},ops[81]=function(){z80.d=z80.c},ops[82]=function(){},ops[83]=function(){z80.d=z80.e},ops[84]=function(){z80.d=z80.h},ops[85]=function(){z80.d=z80.l},ops[86]=function(){tstates+=3;z80.d=readbyte(z80.l|z80.h<<8)},ops[87]=function(){z80.d=z80.a},ops[88]=function(){z80.e=z80.b},ops[89]=function(){z80.e=z80.c},ops[90]=function(){z80.e=z80.d},ops[91]=function(){},ops[92]=function(){z80.e=z80.h},ops[93]=function(){z80.e=z80.l},ops[94]=function(){tstates+=3;z80.e=readbyte(z80.l|z80.h<<8)},ops[95]=function(){z80.e=z80.a},ops[96]=function(){z80.h=z80.b},ops[97]=function(){z80.h=z80.c},ops[98]=function(){z80.h=z80.d},ops[99]=function(){z80.h=z80.e},ops[100]=function(){},ops[101]=function(){z80.h=z80.l},ops[102]=function(){tstates+=3;z80.h=readbyte(z80.l|z80.h<<8)},ops[103]=function(){z80.h=z80.a},ops[104]=function(){z80.l=z80.b},ops[105]=function(){z80.l=z80.c},ops[106]=function(){z80.l=z80.d},ops[107]=function(){z80.l=z80.e},ops[108]=function(){z80.l=z80.h},ops[109]=function(){},ops[110]=function(){tstates+=3;z80.l=readbyte(z80.l|z80.h<<8)},ops[111]=function(){z80.l=z80.a},ops[112]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.b)},ops[113]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.c)},ops[114]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.d)},ops[115]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.e)},ops[116]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.h)},ops[117]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.l)},ops[118]=function(){z80.halted=1;z80.pc--;z80.pc&=65535},ops[119]=function(){tstates+=3;writebyte(z80.l|z80.h<<8,z80.a)},ops[120]=function(){z80.a=z80.b},ops[121]=function(){z80.a=z80.c},ops[122]=function(){z80.a=z80.d},ops[123]=function(){z80.a=z80.e},ops[124]=function(){z80.a=z80.h},ops[125]=function(){z80.a=z80.l},ops[126]=function(){tstates+=3;z80.a=readbyte(z80.l|z80.h<<8)},ops[127]=function(){},ops[128]=function(){var addtemp=z80.a+z80.b,lookup=(z80.a&136)>>3|(z80.b&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[129]=function(){var addtemp=z80.a+z80.c,lookup=(z80.a&136)>>3|(z80.c&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[130]=function(){var addtemp=z80.a+z80.d,lookup=(z80.a&136)>>3|(z80.d&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[131]=function(){var addtemp=z80.a+z80.e,lookup=(z80.a&136)>>3|(z80.e&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[132]=function(){var addtemp=z80.a+z80.h,lookup=(z80.a&136)>>3|(z80.h&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[133]=function(){var addtemp=z80.a+z80.l,lookup=(z80.a&136)>>3|(z80.l&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[134]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8),addtemp=z80.a+bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[135]=function(){var addtemp=z80.a+z80.a,lookup=(z80.a&136)>>3|(z80.a&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[136]=function(){var adctemp=z80.a+z80.b+(z80.f&1),lookup=(z80.a&136)>>3|(z80.b&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[137]=function(){var adctemp=z80.a+z80.c+(z80.f&1),lookup=(z80.a&136)>>3|(z80.c&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[138]=function(){var adctemp=z80.a+z80.d+(z80.f&1),lookup=(z80.a&136)>>3|(z80.d&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[139]=function(){var adctemp=z80.a+z80.e+(z80.f&1),lookup=(z80.a&136)>>3|(z80.e&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[140]=function(){var adctemp=z80.a+z80.h+(z80.f&1),lookup=(z80.a&136)>>3|(z80.h&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[141]=function(){var adctemp=z80.a+z80.l+(z80.f&1),lookup=(z80.a&136)>>3|(z80.l&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[142]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8),adctemp=z80.a+bytetemp+(z80.f&1),lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[143]=function(){var adctemp=z80.a+z80.a+(z80.f&1),lookup=(z80.a&136)>>3|(z80.a&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[144]=function(){var subtemp=z80.a-z80.b,lookup=(z80.a&136)>>3|(z80.b&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[145]=function(){var subtemp=z80.a-z80.c,lookup=(z80.a&136)>>3|(z80.c&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[146]=function(){var subtemp=z80.a-z80.d,lookup=(z80.a&136)>>3|(z80.d&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[147]=function(){var subtemp=z80.a-z80.e,lookup=(z80.a&136)>>3|(z80.e&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[148]=function(){var subtemp=z80.a-z80.h,lookup=(z80.a&136)>>3|(z80.h&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[149]=function(){var subtemp=z80.a-z80.l,lookup=(z80.a&136)>>3|(z80.l&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[150]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8),subtemp=z80.a-bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[151]=function(){var subtemp=z80.a-z80.a,lookup=(z80.a&136)>>3|(z80.a&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[152]=function(){var sbctemp=z80.a-z80.b-(z80.f&1),lookup=(z80.a&136)>>3|(z80.b&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[153]=function(){var sbctemp=z80.a-z80.c-(z80.f&1),lookup=(z80.a&136)>>3|(z80.c&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[154]=function(){var sbctemp=z80.a-z80.d-(z80.f&1),lookup=(z80.a&136)>>3|(z80.d&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[155]=function(){var sbctemp=z80.a-z80.e-(z80.f&1),lookup=(z80.a&136)>>3|(z80.e&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[156]=function(){var sbctemp=z80.a-z80.h-(z80.f&1),lookup=(z80.a&136)>>3|(z80.h&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[157]=function(){var sbctemp=z80.a-z80.l-(z80.f&1),lookup=(z80.a&136)>>3|(z80.l&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[158]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8),sbctemp=z80.a-bytetemp-(z80.f&1),lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[159]=function(){var sbctemp=z80.a-z80.a-(z80.f&1),lookup=(z80.a&136)>>3|(z80.a&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[160]=function(){z80.a&=z80.b;z80.f=16|sz53p_table[z80.a]},ops[161]=function(){z80.a&=z80.c;z80.f=16|sz53p_table[z80.a]},ops[162]=function(){z80.a&=z80.d;z80.f=16|sz53p_table[z80.a]},ops[163]=function(){z80.a&=z80.e;z80.f=16|sz53p_table[z80.a]},ops[164]=function(){z80.a&=z80.h;z80.f=16|sz53p_table[z80.a]},ops[165]=function(){z80.a&=z80.l;z80.f=16|sz53p_table[z80.a]},ops[166]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8);z80.a&=bytetemp;z80.f=16|sz53p_table[z80.a]},ops[167]=function(){z80.a&=z80.a;z80.f=16|sz53p_table[z80.a]},ops[168]=function(){z80.a^=z80.b;z80.f=sz53p_table[z80.a]},ops[169]=function(){z80.a^=z80.c;z80.f=sz53p_table[z80.a]},ops[170]=function(){z80.a^=z80.d;z80.f=sz53p_table[z80.a]},ops[171]=function(){z80.a^=z80.e;z80.f=sz53p_table[z80.a]},ops[172]=function(){z80.a^=z80.h;z80.f=sz53p_table[z80.a]},ops[173]=function(){z80.a^=z80.l;z80.f=sz53p_table[z80.a]},ops[174]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8);z80.a^=bytetemp;z80.f=sz53p_table[z80.a]},ops[175]=function(){z80.a^=z80.a;z80.f=sz53p_table[z80.a]},ops[176]=function(){z80.a|=z80.b;z80.f=sz53p_table[z80.a]},ops[177]=function(){z80.a|=z80.c;z80.f=sz53p_table[z80.a]},ops[178]=function(){z80.a|=z80.d;z80.f=sz53p_table[z80.a]},ops[179]=function(){z80.a|=z80.e;z80.f=sz53p_table[z80.a]},ops[180]=function(){z80.a|=z80.h;z80.f=sz53p_table[z80.a]},ops[181]=function(){z80.a|=z80.l;z80.f=sz53p_table[z80.a]},ops[182]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8);z80.a|=bytetemp;z80.f=sz53p_table[z80.a]},ops[183]=function(){z80.a|=z80.a;z80.f=sz53p_table[z80.a]},ops[184]=function(){var cptemp=z80.a-z80.b,lookup=(z80.a&136)>>3|(z80.b&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.b&40|cptemp&128},ops[185]=function(){var cptemp=z80.a-z80.c,lookup=(z80.a&136)>>3|(z80.c&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.c&40|cptemp&128},ops[186]=function(){var cptemp=z80.a-z80.d,lookup=(z80.a&136)>>3|(z80.d&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.d&40|cptemp&128},ops[187]=function(){var cptemp=z80.a-z80.e,lookup=(z80.a&136)>>3|(z80.e&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.e&40|cptemp&128},ops[188]=function(){var cptemp=z80.a-z80.h,lookup=(z80.a&136)>>3|(z80.h&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.h&40|cptemp&128},ops[189]=function(){var cptemp=z80.a-z80.l,lookup=(z80.a&136)>>3|(z80.l&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.l&40|cptemp&128},ops[190]=function(){tstates+=3;var bytetemp=readbyte(z80.l|z80.h<<8),cptemp=z80.a-bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|bytetemp&40|cptemp&128},ops[191]=function(){var cptemp=z80.a-z80.a,lookup=(z80.a&136)>>3|(z80.a&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.a&40|cptemp&128},ops[192]=function(){var lowbyte,highbyte;tstates++;z80.f&64||(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[193]=function(){tstates+=6;z80.c=readbyte(z80.sp++);z80.sp&=65535;z80.b=readbyte(z80.sp++);z80.sp&=65535},ops[194]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&64?z80.pc+=2:(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8)},ops[195]=function(){var jptemp,pcl,pch;tstates+=6;jptemp=z80.pc;pcl=readbyte(jptemp++);jptemp&=65535;pch=readbyte(jptemp);z80.pc=pcl|pch<<8},ops[196]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&64?z80.pc+=2:(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8)},ops[197]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.b);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.c)},ops[198]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++),addtemp=z80.a+bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[199]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=0},ops[200]=function(){var lowbyte,highbyte;tstates++;z80.f&64&&(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[201]=function(){var lowbyte,highbyte;tstates+=6;lowbyte=readbyte(z80.sp++);z80.sp&=65535;highbyte=readbyte(z80.sp++);z80.sp&=65535;z80.pc=lowbyte|highbyte<<8},ops[202]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&64?(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8):z80.pc+=2},ops[203]=function(){var opcode2;tstates+=4;opcode2=readbyte(z80.pc++);z80.pc&=65535;z80.r=z80.r+1&127;z80_cbxx(opcode2)},ops[204]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&64?(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8):z80.pc+=2},ops[205]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;calltempl=readbyte(z80.pc++);z80.pc&=65535;tstates++;calltemph=readbyte(z80.pc++);z80.pc&=65535;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);pcl=calltempl;pch=calltemph;z80.pc=pcl|pch<<8},ops[206]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++),adctemp=z80.a+bytetemp+(z80.f&1),lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[207]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=8},ops[208]=function(){var lowbyte,highbyte;tstates++;z80.f&1||(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[209]=function(){tstates+=6;z80.e=readbyte(z80.sp++);z80.sp&=65535;z80.d=readbyte(z80.sp++);z80.sp&=65535},ops[210]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&1?z80.pc+=2:(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8)},ops[211]=function(){var outtemp;tstates+=4;outtemp=readbyte(z80.pc++)+(z80.a<<8);z80.pc&=65535;tstates+=3;writeport(outtemp,z80.a)},ops[212]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&1?z80.pc+=2:(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8)},ops[213]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.d);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.e)},ops[214]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++),subtemp=z80.a-bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[215]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=16},ops[216]=function(){var lowbyte,highbyte;tstates++;z80.f&1&&(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[217]=function(){var bytetemp;bytetemp=z80.b;z80.b=z80.b_;z80.b_=bytetemp;bytetemp=z80.c;z80.c=z80.c_;z80.c_=bytetemp;bytetemp=z80.d;z80.d=z80.d_;z80.d_=bytetemp;bytetemp=z80.e;z80.e=z80.e_;z80.e_=bytetemp;bytetemp=z80.h;z80.h=z80.h_;z80.h_=bytetemp;bytetemp=z80.l;z80.l=z80.l_;z80.l_=bytetemp},ops[218]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&1?(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8):z80.pc+=2},ops[219]=function(){var intemp;tstates+=4;intemp=readbyte(z80.pc++)+(z80.a<<8);z80.pc&=65535;tstates+=3;z80.a=readport(intemp)},ops[220]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&1?(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8):z80.pc+=2},ops[221]=function(){var opcode2;tstates+=4;opcode2=readbyte(z80.pc++);z80.pc&=65535;z80.r=z80.r+1&127;z80_ddxx(opcode2)},ops[222]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++),sbctemp=z80.a-bytetemp-(z80.f&1),lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[223]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=24},ops[224]=function(){var lowbyte,highbyte;tstates++;z80.f&4||(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[225]=function(){tstates+=6;z80.l=readbyte(z80.sp++);z80.sp&=65535;z80.h=readbyte(z80.sp++);z80.sp&=65535},ops[226]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&4?z80.pc+=2:(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8)},ops[227]=function(){var bytetempl=readbyte(z80.sp),bytetemph=readbyte(z80.sp+1);tstates+=15;writebyte(z80.sp+1,z80.h);writebyte(z80.sp,z80.l);z80.l=bytetempl;z80.h=bytetemph},ops[228]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&4?z80.pc+=2:(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8)},ops[229]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.h);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.l)},ops[230]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++);z80.a&=bytetemp;z80.f=16|sz53p_table[z80.a]},ops[231]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=32},ops[232]=function(){var lowbyte,highbyte;tstates++;z80.f&4&&(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[233]=function(){z80.pc=z80.l|z80.h<<8},ops[234]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&4?(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8):z80.pc+=2},ops[235]=function(){var bytetemp;bytetemp=z80.d;z80.d=z80.h;z80.h=bytetemp;bytetemp=z80.e;z80.e=z80.l;z80.l=bytetemp},ops[236]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&4?(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8):z80.pc+=2},ops[237]=function(){var opcode2;tstates+=4;opcode2=readbyte(z80.pc++);z80.pc&=65535;z80.r=z80.r+1&127;z80_edxx(opcode2)},ops[238]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++);z80.a^=bytetemp;z80.f=sz53p_table[z80.a]},ops[239]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=40},ops[240]=function(){var lowbyte,highbyte;tstates++;z80.f&128||(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[241]=function(){tstates+=6;z80.f=readbyte(z80.sp++);z80.sp&=65535;z80.a=readbyte(z80.sp++);z80.sp&=65535},ops[242]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&128?z80.pc+=2:(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8)},ops[243]=function(){z80.iff1=z80.iff2=0},ops[244]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&128?z80.pc+=2:(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8)},ops[245]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.a);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.f)},ops[246]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++);z80.a|=bytetemp;z80.f=sz53p_table[z80.a]},ops[247]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=48},ops[248]=function(){var lowbyte,highbyte;tstates++;z80.f&128&&(tstates+=6,lowbyte=readbyte(z80.sp++),z80.sp&=65535,highbyte=readbyte(z80.sp++),z80.sp&=65535,z80.pc=lowbyte|highbyte<<8)},ops[249]=function(){tstates+=2;z80.sp=z80.l|z80.h<<8},ops[250]=function(){var jptemp,pcl,pch;tstates+=6;z80.f&128?(jptemp=z80.pc,pcl=readbyte(jptemp++),jptemp&=65535,pch=readbyte(jptemp),z80.pc=pcl|pch<<8):z80.pc+=2},ops[251]=function(){z80.iff1=z80.iff2=1},ops[252]=function(){var calltempl,calltemph,pcl,pch;tstates+=6;z80.f&128?(calltempl=readbyte(z80.pc++),z80.pc&=65535,tstates++,calltemph=readbyte(z80.pc++),z80.pc&=65535,tstates+=6,z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc>>8),z80.sp--,z80.sp&=65535,writebyte(z80.sp,z80.pc&255),pcl=calltempl,pch=calltemph,z80.pc=pcl|pch<<8):z80.pc+=2},ops[253]=function(){var opcode2;tstates+=4;opcode2=readbyte(z80.pc++);z80.pc&=65535;z80.r=z80.r+1&127;z80_fdxx(opcode2)},ops[254]=function(){tstates+=3;var bytetemp=readbyte(z80.pc++),cptemp=z80.a-bytetemp,lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|bytetemp&40|cptemp&128},ops[255]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc>>8);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.pc&255);z80.pc=56},ops[256]=function(){},z80_defaults(ops),ops}();z80_ed_ops=function(){var ops=[];return ops[64]=function(){tstates+=1;tstates+=3;z80.b=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.b]},ops[65]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.b)},ops[66]=function(){tstates+=7;var sub16temp=(z80.l|z80.h<<8)-(z80.c|z80.b<<8)-(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.c|z80.b<<8)&34816)>>10|(sub16temp&34816)>>9;z80.h=sub16temp>>8&255;z80.l=sub16temp&255;z80.f=(sub16temp&65536?1:0)|2|overflow_sub_table[lookup>>4]|z80.h&168|halfcarry_sub_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[67]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.c);ldtemp&=65535;writebyte(ldtemp,z80.b)},ops[68]=ops[76]=ops[84]=ops[92]=ops[100]=ops[108]=ops[116]=ops[124]=function(){var bytetemp=z80.a,subtemp,lookup;z80.a=0;subtemp=z80.a-bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[69]=ops[77]=ops[85]=ops[93]=ops[101]=ops[109]=ops[117]=ops[125]=function(){var lowbyte,highbyte;z80.iff1=z80.iff2;tstates+=6;lowbyte=readbyte(z80.sp++);z80.sp&=65535;highbyte=readbyte(z80.sp++);z80.sp&=65535;z80.pc=lowbyte|highbyte<<8},ops[70]=ops[78]=ops[102]=ops[110]=function(){z80.im=0},ops[71]=function(){tstates+=1;z80.i=z80.a},ops[72]=function(){tstates+=1;tstates+=3;z80.c=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.c]},ops[73]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.c)},ops[74]=function(){tstates+=7;var add16temp=(z80.l|z80.h<<8)+(z80.c|z80.b<<8)+(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.c|z80.b<<8)&34816)>>10|(add16temp&34816)>>9;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=(add16temp&65536?1:0)|overflow_add_table[lookup>>4]|z80.h&168|halfcarry_add_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[75]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.c=readbyte(ldtemp++);ldtemp&=65535;z80.b=readbyte(ldtemp)},ops[79]=function(){tstates+=1;z80.r=z80.r7=z80.a},ops[80]=function(){tstates+=1;tstates+=3;z80.d=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.d]},ops[81]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.d)},ops[82]=function(){tstates+=7;var sub16temp=(z80.l|z80.h<<8)-(z80.e|z80.d<<8)-(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.e|z80.d<<8)&34816)>>10|(sub16temp&34816)>>9;z80.h=sub16temp>>8&255;z80.l=sub16temp&255;z80.f=(sub16temp&65536?1:0)|2|overflow_sub_table[lookup>>4]|z80.h&168|halfcarry_sub_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[83]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.e);ldtemp&=65535;writebyte(ldtemp,z80.d)},ops[86]=ops[118]=function(){z80.im=1},ops[87]=function(){tstates+=1;z80.a=z80.i;z80.f=z80.f&1|sz53_table[z80.a]|(z80.iff2?4:0)},ops[88]=function(){tstates+=1;tstates+=3;z80.e=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.e]},ops[89]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.e)},ops[90]=function(){tstates+=7;var add16temp=(z80.l|z80.h<<8)+(z80.e|z80.d<<8)+(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.e|z80.d<<8)&34816)>>10|(add16temp&34816)>>9;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=(add16temp&65536?1:0)|overflow_add_table[lookup>>4]|z80.h&168|halfcarry_add_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[91]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.e=readbyte(ldtemp++);ldtemp&=65535;z80.d=readbyte(ldtemp)},ops[94]=ops[126]=function(){z80.im=2},ops[95]=function(){tstates+=1;z80.a=z80.r&127|z80.r7&128;z80.f=z80.f&1|sz53_table[z80.a]|(z80.iff2?4:0)},ops[96]=function(){tstates+=1;tstates+=3;z80.h=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.h]},ops[97]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.h)},ops[98]=function(){tstates+=7;var sub16temp=(z80.l|z80.h<<8)-(z80.l|z80.h<<8)-(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.l|z80.h<<8)&34816)>>10|(sub16temp&34816)>>9;z80.h=sub16temp>>8&255;z80.l=sub16temp&255;z80.f=(sub16temp&65536?1:0)|2|overflow_sub_table[lookup>>4]|z80.h&168|halfcarry_sub_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[99]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.l);ldtemp&=65535;writebyte(ldtemp,z80.h)},ops[103]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=10;writebyte(z80.l|z80.h<<8,(z80.a&15)<<4|bytetemp>>4);z80.a=z80.a&240|bytetemp&15;z80.f=z80.f&1|sz53p_table[z80.a]},ops[104]=function(){tstates+=1;tstates+=3;z80.l=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.l]},ops[105]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.l)},ops[106]=function(){tstates+=7;var add16temp=(z80.l|z80.h<<8)+(z80.l|z80.h<<8)+(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|((z80.l|z80.h<<8)&34816)>>10|(add16temp&34816)>>9;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=(add16temp&65536?1:0)|overflow_add_table[lookup>>4]|z80.h&168|halfcarry_add_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[107]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.l=readbyte(ldtemp++);ldtemp&=65535;z80.h=readbyte(ldtemp)},ops[111]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=10;writebyte(z80.l|z80.h<<8,(bytetemp&15)<<4|z80.a&15);z80.a=z80.a&240|bytetemp>>4;z80.f=z80.f&1|sz53p_table[z80.a]},ops[112]=function(){tstates+=1;var bytetemp;tstates+=3;bytetemp=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[bytetemp]},ops[113]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,0)},ops[114]=function(){tstates+=7;var sub16temp=(z80.l|z80.h<<8)-z80.sp-(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|(z80.sp&34816)>>10|(sub16temp&34816)>>9;z80.h=sub16temp>>8&255;z80.l=sub16temp&255;z80.f=(sub16temp&65536?1:0)|2|overflow_sub_table[lookup>>4]|z80.h&168|halfcarry_sub_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[115]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.sp&255);ldtemp&=65535;writebyte(ldtemp,z80.sp>>8)},ops[120]=function(){tstates+=1;tstates+=3;z80.a=readport(z80.c|z80.b<<8);z80.f=z80.f&1|sz53p_table[z80.a]},ops[121]=function(){tstates+=1;tstates+=3;writeport(z80.c|z80.b<<8,z80.a)},ops[122]=function(){tstates+=7;var add16temp=(z80.l|z80.h<<8)+z80.sp+(z80.f&1),lookup=((z80.l|z80.h<<8)&34816)>>11|(z80.sp&34816)>>10|(add16temp&34816)>>9;z80.h=add16temp>>8&255;z80.l=add16temp&255;z80.f=(add16temp&65536?1:0)|overflow_add_table[lookup>>4]|z80.h&168|halfcarry_add_table[lookup&7]|(z80.l|z80.h<<8?0:64)},ops[123]=function(){var ldtemp,regl,regh;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;regl=readbyte(ldtemp++);ldtemp&=65535;regh=readbyte(ldtemp);z80.sp=regl|regh<<8},ops[160]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),bctemp,detemp,hltemp;tstates+=8;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;writebyte(z80.e|z80.d<<8,bytetemp);detemp=(z80.e|z80.d<<8)+1&65535;z80.d=detemp>>8;z80.e=detemp&255;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bytetemp=bytetemp+z80.a&255;z80.f=z80.f&193|(z80.c|z80.b<<8?4:0)|bytetemp&8|(bytetemp&2?32:0)},ops[161]=function(){var value=readbyte(z80.l|z80.h<<8),bytetemp=z80.a-value&255,lookup=(z80.a&8)>>3|(value&8)>>2|(bytetemp&8)>>1,hltemp,bctemp;tstates+=8;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;z80.f=z80.f&1|(z80.c|z80.b<<8?6:2)|halfcarry_sub_table[lookup]|(bytetemp?0:64)|bytetemp&128;z80.f&16&&bytetemp--;z80.f|=bytetemp&8|(bytetemp&2?32:0)},ops[162]=function(){var initemp=readport(z80.c|z80.b<<8),hltemp;tstates+=5;tstates+=3;writebyte(z80.l|z80.h<<8,initemp);z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;z80.f=(initemp&128?2:0)|sz53_table[z80.b]},ops[163]=function(){var outitemp=readbyte(z80.l|z80.h<<8),hltemp;z80.b=z80.b-1&255;tstates+=5;tstates+=3;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;writeport(z80.c|z80.b<<8,outitemp);z80.f=(outitemp&128?2:0)|sz53_table[z80.b]},ops[168]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),bctemp,detemp,hltemp;tstates+=8;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;writebyte(z80.e|z80.d<<8,bytetemp);detemp=(z80.e|z80.d<<8)-1&65535;z80.d=detemp>>8;z80.e=detemp&255;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bytetemp=bytetemp+z80.a&255;z80.f=z80.f&193|(z80.c|z80.b<<8?4:0)|bytetemp&8|(bytetemp&2?32:0)},ops[169]=function(){var value=readbyte(z80.l|z80.h<<8),bytetemp=z80.a-value&255,lookup=(z80.a&8)>>3|(value&8)>>2|(bytetemp&8)>>1,hltemp,bctemp;tstates+=8;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;z80.f=z80.f&1|(z80.c|z80.b<<8?6:2)|halfcarry_sub_table[lookup]|(bytetemp?0:64)|bytetemp&128;z80.f&16&&bytetemp--;z80.f|=bytetemp&8|(bytetemp&2?32:0)},ops[170]=function(){var initemp=readport(z80.c|z80.b<<8),hltemp;tstates+=5;tstates+=3;writebyte(z80.l|z80.h<<8,initemp);z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;z80.f=(initemp&128?2:0)|sz53_table[z80.b]},ops[171]=function(){var outitemp=readbyte(z80.l|z80.h<<8),hltemp;z80.b=z80.b-1&255;tstates+=5;tstates+=3;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;writeport(z80.c|z80.b<<8,outitemp);z80.f=(outitemp&128?2:0)|sz53_table[z80.b]},ops[176]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),hltemp,detemp,bctemp;tstates+=8;writebyte(z80.e|z80.d<<8,bytetemp);hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;detemp=(z80.e|z80.d<<8)+1&65535;z80.d=detemp>>8;z80.e=detemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;bytetemp=bytetemp+z80.a&255;z80.f=z80.f&193|(z80.c|z80.b<<8?4:0)|bytetemp&8|(bytetemp&2?32:0);z80.c|z80.b<<8&&(tstates+=5,z80.pc-=2)},ops[177]=function(){var value=readbyte(z80.l|z80.h<<8),bytetemp=z80.a-value&255,lookup=(z80.a&8)>>3|(value&8)>>2|(bytetemp&8)>>1,hltemp,bctemp;tstates+=8;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;z80.f=z80.f&1|(z80.c|z80.b<<8?6:2)|halfcarry_sub_table[lookup]|(bytetemp?0:64)|bytetemp&128;z80.f&16&&bytetemp--;z80.f|=bytetemp&8|(bytetemp&2?32:0);(z80.f&68)==4&&(tstates+=5,z80.pc-=2)},ops[178]=function(){var initemp=readport(z80.c|z80.b<<8),hltemp;tstates+=5;tstates+=3;writebyte(z80.l|z80.h<<8,initemp);z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;z80.f=(initemp&128?2:0)|sz53_table[z80.b];z80.b&&(tstates+=5,z80.pc-=2)},ops[179]=function(){var outitemp=readbyte(z80.l|z80.h<<8),hltemp;tstates+=5;z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)+1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;writeport(z80.c|z80.b<<8,outitemp);z80.f=(outitemp&128?2:0)|sz53_table[z80.b];z80.b?(tstates+=1,tstates+=7,z80.pc-=2):tstates+=3},ops[184]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),hltemp,detemp,bctemp;tstates+=8;writebyte(z80.e|z80.d<<8,bytetemp);hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;detemp=(z80.e|z80.d<<8)-1&65535;z80.d=detemp>>8;z80.e=detemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;bytetemp=bytetemp+z80.a&255;z80.f=z80.f&193|(z80.c|z80.b<<8?4:0)|bytetemp&8|(bytetemp&2?32:0);z80.c|z80.b<<8&&(tstates+=5,z80.pc-=2)},ops[185]=function(){var value=readbyte(z80.l|z80.h<<8),bytetemp=z80.a-value&255,lookup=(z80.a&8)>>3|(value&8)>>2|(bytetemp&8)>>1,hltemp,bctemp;tstates+=8;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;bctemp=(z80.c|z80.b<<8)-1&65535;z80.b=bctemp>>8;z80.c=bctemp&255;z80.f=z80.f&1|(z80.c|z80.b<<8?6:2)|halfcarry_sub_table[lookup]|(bytetemp?0:64)|bytetemp&128;z80.f&16&&bytetemp--;z80.f|=bytetemp&8|(bytetemp&2?32:0);(z80.f&68)==4&&(tstates+=5,z80.pc-=2)},ops[186]=function(){var initemp=readport(z80.c|z80.b<<8),hltemp;tstates+=5;tstates+=3;writebyte(z80.l|z80.h<<8,initemp);z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;z80.f=(initemp&128?2:0)|sz53_table[z80.b];z80.b&&(tstates+=5,z80.pc-=2)},ops[187]=function(){var outitemp=readbyte(z80.l|z80.h<<8),hltemp;tstates+=5;z80.b=z80.b-1&255;hltemp=(z80.l|z80.h<<8)-1&65535;z80.h=hltemp>>8;z80.l=hltemp&255;writeport(z80.c|z80.b<<8,outitemp);z80.f=(outitemp&128?2:0)|sz53_table[z80.b];z80.b?(tstates+=1,tstates+=7,z80.pc-=2):tstates+=3},ops[256]=function(){},z80_defaults(ops),ops}();z80_cb_ops=function(){var ops=[];return ops[0]=function(){z80.b=(z80.b&127)<<1|z80.b>>7;z80.f=z80.b&1|sz53p_table[z80.b]},ops[1]=function(){z80.c=(z80.c&127)<<1|z80.c>>7;z80.f=z80.c&1|sz53p_table[z80.c]},ops[2]=function(){z80.d=(z80.d&127)<<1|z80.d>>7;z80.f=z80.d&1|sz53p_table[z80.d]},ops[3]=function(){z80.e=(z80.e&127)<<1|z80.e>>7;z80.f=z80.e&1|sz53p_table[z80.e]},ops[4]=function(){z80.h=(z80.h&127)<<1|z80.h>>7;z80.f=z80.h&1|sz53p_table[z80.h]},ops[5]=function(){z80.l=(z80.l&127)<<1|z80.l>>7;z80.f=z80.l&1|sz53p_table[z80.l]},ops[6]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;bytetemp=(bytetemp&127)<<1|bytetemp>>7;z80.f=bytetemp&1|sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[7]=function(){z80.a=(z80.a&127)<<1|z80.a>>7;z80.f=z80.a&1|sz53p_table[z80.a]},ops[8]=function(){z80.f=z80.b&1;z80.b=z80.b>>1|(z80.b&1)<<7;z80.f|=sz53p_table[z80.b]},ops[9]=function(){z80.f=z80.c&1;z80.c=z80.c>>1|(z80.c&1)<<7;z80.f|=sz53p_table[z80.c]},ops[10]=function(){z80.f=z80.d&1;z80.d=z80.d>>1|(z80.d&1)<<7;z80.f|=sz53p_table[z80.d]},ops[11]=function(){z80.f=z80.e&1;z80.e=z80.e>>1|(z80.e&1)<<7;z80.f|=sz53p_table[z80.e]},ops[12]=function(){z80.f=z80.h&1;z80.h=z80.h>>1|(z80.h&1)<<7;z80.f|=sz53p_table[z80.h]},ops[13]=function(){z80.f=z80.l&1;z80.l=z80.l>>1|(z80.l&1)<<7;z80.f|=sz53p_table[z80.l]},ops[14]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;z80.f=bytetemp&1;bytetemp=bytetemp>>1|(bytetemp&1)<<7;z80.f|=sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[15]=function(){z80.f=z80.a&1;z80.a=z80.a>>1|(z80.a&1)<<7;z80.f|=sz53p_table[z80.a]},ops[16]=function(){var rltemp=z80.b;z80.b=(z80.b&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.b]},ops[17]=function(){var rltemp=z80.c;z80.c=(z80.c&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.c]},ops[18]=function(){var rltemp=z80.d;z80.d=(z80.d&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.d]},ops[19]=function(){var rltemp=z80.e;z80.e=(z80.e&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.e]},ops[20]=function(){var rltemp=z80.h;z80.h=(z80.h&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.h]},ops[21]=function(){var rltemp=z80.l;z80.l=(z80.l&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.l]},ops[22]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),rltemp;tstates+=7;rltemp=bytetemp;bytetemp=(bytetemp&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[23]=function(){var rltemp=z80.a;z80.a=(z80.a&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.a]},ops[24]=function(){var rrtemp=z80.b;z80.b=z80.b>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.b]},ops[25]=function(){var rrtemp=z80.c;z80.c=z80.c>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.c]},ops[26]=function(){var rrtemp=z80.d;z80.d=z80.d>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.d]},ops[27]=function(){var rrtemp=z80.e;z80.e=z80.e>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.e]},ops[28]=function(){var rrtemp=z80.h;z80.h=z80.h>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.h]},ops[29]=function(){var rrtemp=z80.l;z80.l=z80.l>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.l]},ops[30]=function(){var bytetemp=readbyte(z80.l|z80.h<<8),rrtemp;tstates+=7;rrtemp=bytetemp;bytetemp=bytetemp>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[31]=function(){var rrtemp=z80.a;z80.a=z80.a>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.a]},ops[32]=function(){z80.f=z80.b>>7;z80.b<<=1;z80.b&=255;z80.f|=sz53p_table[z80.b]},ops[33]=function(){z80.f=z80.c>>7;z80.c<<=1;z80.c&=255;z80.f|=sz53p_table[z80.c]},ops[34]=function(){z80.f=z80.d>>7;z80.d<<=1;z80.d&=255;z80.f|=sz53p_table[z80.d]},ops[35]=function(){z80.f=z80.e>>7;z80.e<<=1;z80.e&=255;z80.f|=sz53p_table[z80.e]},ops[36]=function(){z80.f=z80.h>>7;z80.h<<=1;z80.h&=255;z80.f|=sz53p_table[z80.h]},ops[37]=function(){z80.f=z80.l>>7;z80.l<<=1;z80.l&=255;z80.f|=sz53p_table[z80.l]},ops[38]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;z80.f=bytetemp>>7;bytetemp<<=1;bytetemp&=255;z80.f|=sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[39]=function(){z80.f=z80.a>>7;z80.a<<=1;z80.a&=255;z80.f|=sz53p_table[z80.a]},ops[40]=function(){z80.f=z80.b&1;z80.b=z80.b&128|z80.b>>1;z80.f|=sz53p_table[z80.b]},ops[41]=function(){z80.f=z80.c&1;z80.c=z80.c&128|z80.c>>1;z80.f|=sz53p_table[z80.c]},ops[42]=function(){z80.f=z80.d&1;z80.d=z80.d&128|z80.d>>1;z80.f|=sz53p_table[z80.d]},ops[43]=function(){z80.f=z80.e&1;z80.e=z80.e&128|z80.e>>1;z80.f|=sz53p_table[z80.e]},ops[44]=function(){z80.f=z80.h&1;z80.h=z80.h&128|z80.h>>1;z80.f|=sz53p_table[z80.h]},ops[45]=function(){z80.f=z80.l&1;z80.l=z80.l&128|z80.l>>1;z80.f|=sz53p_table[z80.l]},ops[46]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;z80.f=bytetemp&1;bytetemp=bytetemp&128|bytetemp>>1;z80.f|=sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[47]=function(){z80.f=z80.a&1;z80.a=z80.a&128|z80.a>>1;z80.f|=sz53p_table[z80.a]},ops[48]=function(){z80.f=z80.b>>7;z80.b=z80.b<<1|1;z80.b&=255;z80.f|=sz53p_table[z80.b]},ops[49]=function(){z80.f=z80.c>>7;z80.c=z80.c<<1|1;z80.c&=255;z80.f|=sz53p_table[z80.c]},ops[50]=function(){z80.f=z80.d>>7;z80.d=z80.d<<1|1;z80.d&=255;z80.f|=sz53p_table[z80.d]},ops[51]=function(){z80.f=z80.e>>7;z80.e=z80.e<<1|1;z80.e&=255;z80.f|=sz53p_table[z80.e]},ops[52]=function(){z80.f=z80.h>>7;z80.h=z80.h<<1|1;z80.h&=255;z80.f|=sz53p_table[z80.h]},ops[53]=function(){z80.f=z80.l>>7;z80.l=z80.l<<1|1;z80.l&=255;z80.f|=sz53p_table[z80.l]},ops[54]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;z80.f=bytetemp>>7;bytetemp=bytetemp<<1|1;bytetemp&=255;z80.f|=sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[55]=function(){z80.f=z80.a>>7;z80.a=z80.a<<1|1;z80.a&=255;z80.f|=sz53p_table[z80.a]},ops[56]=function(){z80.f=z80.b&1;z80.b>>=1;z80.f|=sz53p_table[z80.b]},ops[57]=function(){z80.f=z80.c&1;z80.c>>=1;z80.f|=sz53p_table[z80.c]},ops[58]=function(){z80.f=z80.d&1;z80.d>>=1;z80.f|=sz53p_table[z80.d]},ops[59]=function(){z80.f=z80.e&1;z80.e>>=1;z80.f|=sz53p_table[z80.e]},ops[60]=function(){z80.f=z80.h&1;z80.h>>=1;z80.f|=sz53p_table[z80.h]},ops[61]=function(){z80.f=z80.l&1;z80.l>>=1;z80.f|=sz53p_table[z80.l]},ops[62]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=7;z80.f=bytetemp&1;bytetemp>>=1;z80.f|=sz53p_table[bytetemp];writebyte(z80.l|z80.h<<8,bytetemp)},ops[63]=function(){z80.f=z80.a&1;z80.a>>=1;z80.f|=sz53p_table[z80.a]},ops[64]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&1||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[65]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&1||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[66]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&1||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[67]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&1||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[68]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&1||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[69]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&1||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[70]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&1||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[71]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&1||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[72]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&2||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[73]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&2||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[74]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&2||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[75]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&2||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[76]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&2||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[77]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&2||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[78]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&2||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[79]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&2||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[80]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&4||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[81]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&4||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[82]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&4||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[83]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&4||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[84]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&4||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[85]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&4||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[86]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&4||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[87]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&4||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[88]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&8||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[89]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&8||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[90]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&8||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[91]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&8||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[92]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&8||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[93]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&8||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[94]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&8||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[95]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&8||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[96]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&16||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[97]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&16||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[98]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&16||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[99]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&16||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[100]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&16||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[101]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&16||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[102]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&16||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[103]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&16||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[104]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&32||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[105]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&32||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[106]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&32||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[107]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&32||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[108]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&32||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[109]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&32||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[110]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&32||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[111]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&32||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[112]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&64||(z80.f|=68);!1&&z80.b&128&&(z80.f|=128)},ops[113]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&64||(z80.f|=68);!1&&z80.c&128&&(z80.f|=128)},ops[114]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&64||(z80.f|=68);!1&&z80.d&128&&(z80.f|=128)},ops[115]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&64||(z80.f|=68);!1&&z80.e&128&&(z80.f|=128)},ops[116]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&64||(z80.f|=68);!1&&z80.h&128&&(z80.f|=128)},ops[117]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&64||(z80.f|=68);!1&&z80.l&128&&(z80.f|=128)},ops[118]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&64||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[119]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&64||(z80.f|=68);!1&&z80.a&128&&(z80.f|=128)},ops[120]=function(){z80.f=z80.f&1|16|z80.b&40;z80.b&128||(z80.f|=68);!0&&z80.b&128&&(z80.f|=128)},ops[121]=function(){z80.f=z80.f&1|16|z80.c&40;z80.c&128||(z80.f|=68);!0&&z80.c&128&&(z80.f|=128)},ops[122]=function(){z80.f=z80.f&1|16|z80.d&40;z80.d&128||(z80.f|=68);!0&&z80.d&128&&(z80.f|=128)},ops[123]=function(){z80.f=z80.f&1|16|z80.e&40;z80.e&128||(z80.f|=68);!0&&z80.e&128&&(z80.f|=128)},ops[124]=function(){z80.f=z80.f&1|16|z80.h&40;z80.h&128||(z80.f|=68);!0&&z80.h&128&&(z80.f|=128)},ops[125]=function(){z80.f=z80.f&1|16|z80.l&40;z80.l&128||(z80.f|=68);!0&&z80.l&128&&(z80.f|=128)},ops[126]=function(){var bytetemp=readbyte(z80.l|z80.h<<8);tstates+=4;z80.f=z80.f&1|16|bytetemp&40;bytetemp&128||(z80.f|=68);!0&&bytetemp&128&&(z80.f|=128)},ops[127]=function(){z80.f=z80.f&1|16|z80.a&40;z80.a&128||(z80.f|=68);!0&&z80.a&128&&(z80.f|=128)},ops[128]=function(){z80.b&=254},ops[129]=function(){z80.c&=254},ops[130]=function(){z80.d&=254},ops[131]=function(){z80.e&=254},ops[132]=function(){z80.h&=254},ops[133]=function(){z80.l&=254},ops[134]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&254)},ops[135]=function(){z80.a&=254},ops[136]=function(){z80.b&=253},ops[137]=function(){z80.c&=253},ops[138]=function(){z80.d&=253},ops[139]=function(){z80.e&=253},ops[140]=function(){z80.h&=253},ops[141]=function(){z80.l&=253},ops[142]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&253)},ops[143]=function(){z80.a&=253},ops[144]=function(){z80.b&=251},ops[145]=function(){z80.c&=251},ops[146]=function(){z80.d&=251},ops[147]=function(){z80.e&=251},ops[148]=function(){z80.h&=251},ops[149]=function(){z80.l&=251},ops[150]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&251)},ops[151]=function(){z80.a&=251},ops[152]=function(){z80.b&=247},ops[153]=function(){z80.c&=247},ops[154]=function(){z80.d&=247},ops[155]=function(){z80.e&=247},ops[156]=function(){z80.h&=247},ops[157]=function(){z80.l&=247},ops[158]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&247)},ops[159]=function(){z80.a&=247},ops[160]=function(){z80.b&=239},ops[161]=function(){z80.c&=239},ops[162]=function(){z80.d&=239},ops[163]=function(){z80.e&=239},ops[164]=function(){z80.h&=239},ops[165]=function(){z80.l&=239},ops[166]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&239)},ops[167]=function(){z80.a&=239},ops[168]=function(){z80.b&=223},ops[169]=function(){z80.c&=223},ops[170]=function(){z80.d&=223},ops[171]=function(){z80.e&=223},ops[172]=function(){z80.h&=223},ops[173]=function(){z80.l&=223},ops[174]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&223)},ops[175]=function(){z80.a&=223},ops[176]=function(){z80.b&=191},ops[177]=function(){z80.c&=191},ops[178]=function(){z80.d&=191},ops[179]=function(){z80.e&=191},ops[180]=function(){z80.h&=191},ops[181]=function(){z80.l&=191},ops[182]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&191)},ops[183]=function(){z80.a&=191},ops[184]=function(){z80.b&=127},ops[185]=function(){z80.c&=127},ops[186]=function(){z80.d&=127},ops[187]=function(){z80.e&=127},ops[188]=function(){z80.h&=127},ops[189]=function(){z80.l&=127},ops[190]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)&127)},ops[191]=function(){z80.a&=127},ops[192]=function(){z80.b|=1},ops[193]=function(){z80.c|=1},ops[194]=function(){z80.d|=1},ops[195]=function(){z80.e|=1},ops[196]=function(){z80.h|=1},ops[197]=function(){z80.l|=1},ops[198]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|1)},ops[199]=function(){z80.a|=1},ops[200]=function(){z80.b|=2},ops[201]=function(){z80.c|=2},ops[202]=function(){z80.d|=2},ops[203]=function(){z80.e|=2},ops[204]=function(){z80.h|=2},ops[205]=function(){z80.l|=2},ops[206]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|2)},ops[207]=function(){z80.a|=2},ops[208]=function(){z80.b|=4},ops[209]=function(){z80.c|=4},ops[210]=function(){z80.d|=4},ops[211]=function(){z80.e|=4},ops[212]=function(){z80.h|=4},ops[213]=function(){z80.l|=4},ops[214]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|4)},ops[215]=function(){z80.a|=4},ops[216]=function(){z80.b|=8},ops[217]=function(){z80.c|=8},ops[218]=function(){z80.d|=8},ops[219]=function(){z80.e|=8},ops[220]=function(){z80.h|=8},ops[221]=function(){z80.l|=8},ops[222]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|8)},ops[223]=function(){z80.a|=8},ops[224]=function(){z80.b|=16},ops[225]=function(){z80.c|=16},ops[226]=function(){z80.d|=16},ops[227]=function(){z80.e|=16},ops[228]=function(){z80.h|=16},ops[229]=function(){z80.l|=16},ops[230]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|16)},ops[231]=function(){z80.a|=16},ops[232]=function(){z80.b|=32},ops[233]=function(){z80.c|=32},ops[234]=function(){z80.d|=32},ops[235]=function(){z80.e|=32},ops[236]=function(){z80.h|=32},ops[237]=function(){z80.l|=32},ops[238]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|32)},ops[239]=function(){z80.a|=32},ops[240]=function(){z80.b|=64},ops[241]=function(){z80.c|=64},ops[242]=function(){z80.d|=64},ops[243]=function(){z80.e|=64},ops[244]=function(){z80.h|=64},ops[245]=function(){z80.l|=64},ops[246]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|64)},ops[247]=function(){z80.a|=64},ops[248]=function(){z80.b|=128},ops[249]=function(){z80.c|=128},ops[250]=function(){z80.d|=128},ops[251]=function(){z80.e|=128},ops[252]=function(){z80.h|=128},ops[253]=function(){z80.l|=128},ops[254]=function(){tstates+=7;writebyte(z80.l|z80.h<<8,readbyte(z80.l|z80.h<<8)|128)},ops[255]=function(){z80.a|=128},ops[256]=function(){},z80_defaults(ops),ops}();z80_dd_ops=function(){var ops=[];return ops[9]=function(){var add16temp=(z80.ixl|z80.ixh<<8)+(z80.c|z80.b<<8),lookup=((z80.ixl|z80.ixh<<8)&2048)>>11|((z80.c|z80.b<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.ixh=add16temp>>8&255;z80.ixl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[25]=function(){var add16temp=(z80.ixl|z80.ixh<<8)+(z80.e|z80.d<<8),lookup=((z80.ixl|z80.ixh<<8)&2048)>>11|((z80.e|z80.d<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.ixh=add16temp>>8&255;z80.ixl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[33]=function(){tstates+=6;z80.ixl=readbyte(z80.pc++);z80.pc&=65535;z80.ixh=readbyte(z80.pc++);z80.pc&=65535},ops[34]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.ixl);ldtemp&=65535;writebyte(ldtemp,z80.ixh)},ops[35]=function(){tstates+=2;var wordtemp=(z80.ixl|z80.ixh<<8)+1&65535;z80.ixh=wordtemp>>8;z80.ixl=wordtemp&255},ops[36]=function(){z80.ixh=z80.ixh+1&255;z80.f=z80.f&1|(z80.ixh==128?4:0)|(z80.ixh&15?0:16)|sz53_table[z80.ixh]},ops[37]=function(){z80.f=z80.f&1|(z80.ixh&15?0:16)|2;z80.ixh=z80.ixh-1&255;z80.f|=(z80.ixh==127?4:0)|sz53_table[z80.ixh]},ops[38]=function(){tstates+=3;z80.ixh=readbyte(z80.pc++);z80.pc&=65535},ops[41]=function(){var add16temp=(z80.ixl|z80.ixh<<8)+(z80.ixl|z80.ixh<<8),lookup=((z80.ixl|z80.ixh<<8)&2048)>>11|((z80.ixl|z80.ixh<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.ixh=add16temp>>8&255;z80.ixl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[42]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.ixl=readbyte(ldtemp++);ldtemp&=65535;z80.ixh=readbyte(ldtemp)},ops[43]=function(){tstates+=2;var wordtemp=(z80.ixl|z80.ixh<<8)-1&65535;z80.ixh=wordtemp>>8;z80.ixl=wordtemp&255},ops[44]=function(){z80.ixl=z80.ixl+1&255;z80.f=z80.f&1|(z80.ixl==128?4:0)|(z80.ixl&15?0:16)|sz53_table[z80.ixl]},ops[45]=function(){z80.f=z80.f&1|(z80.ixl&15?0:16)|2;z80.ixl=z80.ixl-1&255;z80.f|=(z80.ixl==127?4:0)|sz53_table[z80.ixl]},ops[46]=function(){tstates+=3;z80.ixl=readbyte(z80.pc++);z80.pc&=65535},ops[52]=function(){var wordtemp,bytetemp;tstates+=15;wordtemp=(z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;bytetemp=readbyte(wordtemp);bytetemp=bytetemp+1&255;z80.f=z80.f&1|(bytetemp==128?4:0)|(bytetemp&15?0:16)|sz53_table[bytetemp];writebyte(wordtemp,bytetemp)},ops[53]=function(){var wordtemp,bytetemp;tstates+=15;wordtemp=(z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;bytetemp=readbyte(wordtemp);z80.f=z80.f&1|(bytetemp&15?0:16)|2;bytetemp=bytetemp-1&255;z80.f|=(bytetemp==127?4:0)|sz53_table[bytetemp];writebyte(wordtemp,bytetemp)},ops[54]=function(){tstates+=11;var wordtemp=(z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;writebyte(wordtemp,readbyte(z80.pc++));z80.pc&=65535},ops[57]=function(){var add16temp=(z80.ixl|z80.ixh<<8)+z80.sp,lookup=((z80.ixl|z80.ixh<<8)&2048)>>11|(z80.sp&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.ixh=add16temp>>8&255;z80.ixl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[68]=function(){z80.b=z80.ixh},ops[69]=function(){z80.b=z80.ixl},ops[70]=function(){tstates+=11;z80.b=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[76]=function(){z80.c=z80.ixh},ops[77]=function(){z80.c=z80.ixl},ops[78]=function(){tstates+=11;z80.c=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[84]=function(){z80.d=z80.ixh},ops[85]=function(){z80.d=z80.ixl},ops[86]=function(){tstates+=11;z80.d=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[92]=function(){z80.e=z80.ixh},ops[93]=function(){z80.e=z80.ixl},ops[94]=function(){tstates+=11;z80.e=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[96]=function(){z80.ixh=z80.b},ops[97]=function(){z80.ixh=z80.c},ops[98]=function(){z80.ixh=z80.d},ops[99]=function(){z80.ixh=z80.e},ops[100]=function(){},ops[101]=function(){z80.ixh=z80.ixl},ops[102]=function(){tstates+=11;z80.h=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[103]=function(){z80.ixh=z80.a},ops[104]=function(){z80.ixl=z80.b},ops[105]=function(){z80.ixl=z80.c},ops[106]=function(){z80.ixl=z80.d},ops[107]=function(){z80.ixl=z80.e},ops[108]=function(){z80.ixl=z80.ixh},ops[109]=function(){},ops[110]=function(){tstates+=11;z80.l=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[111]=function(){z80.ixl=z80.a},ops[112]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.b);z80.pc&=65535},ops[113]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.c);z80.pc&=65535},ops[114]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.d);z80.pc&=65535},ops[115]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.e);z80.pc&=65535},ops[116]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.h);z80.pc&=65535},ops[117]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.l);z80.pc&=65535},ops[119]=function(){tstates+=11;writebyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.a);z80.pc&=65535},ops[124]=function(){z80.a=z80.ixh},ops[125]=function(){z80.a=z80.ixl},ops[126]=function(){tstates+=11;z80.a=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[132]=function(){var addtemp=z80.a+z80.ixh,lookup=(z80.a&136)>>3|(z80.ixh&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[133]=function(){var addtemp=z80.a+z80.ixl,lookup=(z80.a&136)>>3|(z80.ixl&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[134]=function(){var bytetemp,addtemp,lookup;tstates+=11;bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;addtemp=z80.a+bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[140]=function(){var adctemp=z80.a+z80.ixh+(z80.f&1),lookup=(z80.a&136)>>3|(z80.ixh&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[141]=function(){var adctemp=z80.a+z80.ixl+(z80.f&1),lookup=(z80.a&136)>>3|(z80.ixl&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[142]=function(){var bytetemp,adctemp,lookup;tstates+=11;bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;adctemp=z80.a+bytetemp+(z80.f&1);lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[148]=function(){var subtemp=z80.a-z80.ixh,lookup=(z80.a&136)>>3|(z80.ixh&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[149]=function(){var subtemp=z80.a-z80.ixl,lookup=(z80.a&136)>>3|(z80.ixl&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[150]=function(){var bytetemp,subtemp,lookup;tstates+=11;bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;subtemp=z80.a-bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[156]=function(){var sbctemp=z80.a-z80.ixh-(z80.f&1),lookup=(z80.a&136)>>3|(z80.ixh&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[157]=function(){var sbctemp=z80.a-z80.ixl-(z80.f&1),lookup=(z80.a&136)>>3|(z80.ixl&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[158]=function(){var bytetemp,sbctemp,lookup;tstates+=11;bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;sbctemp=z80.a-bytetemp-(z80.f&1);lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[164]=function(){z80.a&=z80.ixh;z80.f=16|sz53p_table[z80.a]},ops[165]=function(){z80.a&=z80.ixl;z80.f=16|sz53p_table[z80.a]},ops[166]=function(){tstates+=11;var bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a&=bytetemp;z80.f=16|sz53p_table[z80.a]},ops[172]=function(){z80.a^=z80.ixh;z80.f=sz53p_table[z80.a]},ops[173]=function(){z80.a^=z80.ixl;z80.f=sz53p_table[z80.a]},ops[174]=function(){tstates+=11;var bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a^=bytetemp;z80.f=sz53p_table[z80.a]},ops[180]=function(){z80.a|=z80.ixh;z80.f=sz53p_table[z80.a]},ops[181]=function(){z80.a|=z80.ixl;z80.f=sz53p_table[z80.a]},ops[182]=function(){tstates+=11;var bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a|=bytetemp;z80.f=sz53p_table[z80.a]},ops[188]=function(){var cptemp=z80.a-z80.ixh,lookup=(z80.a&136)>>3|(z80.ixh&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.ixh&40|cptemp&128},ops[189]=function(){var cptemp=z80.a-z80.ixl,lookup=(z80.a&136)>>3|(z80.ixl&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.ixl&40|cptemp&128},ops[190]=function(){var bytetemp,cptemp,lookup;tstates+=11;bytetemp=readbyte((z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;cptemp=z80.a-bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|bytetemp&40|cptemp&128},ops[203]=function(tempaddr){var opcode3;tstates+=7;tempaddr=(z80.ixl|z80.ixh<<8)+sign_extend(readbyte(z80.pc++));z80.pc&=65535;opcode3=readbyte(z80.pc++);z80.pc&=65535;z80_ddfdcbxx(opcode3,tempaddr)},ops[225]=function(){tstates+=6;z80.ixl=readbyte(z80.sp++);z80.sp&=65535;z80.ixh=readbyte(z80.sp++);z80.sp&=65535},ops[227]=function(){var bytetempl=readbyte(z80.sp),bytetemph=readbyte(z80.sp+1);tstates+=15;writebyte(z80.sp+1,z80.ixh);writebyte(z80.sp,z80.ixl);z80.ixl=bytetempl;z80.ixh=bytetemph},ops[229]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.ixh);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.ixl)},ops[233]=function(){z80.pc=z80.ixl|z80.ixh<<8},ops[249]=function(){tstates+=2;z80.sp=z80.ixl|z80.ixh<<8},ops[256]=function(){z80.pc--;z80.pc&=65535;z80.r--;z80.r&=127},z80_defaults(ops),ops}();z80_fd_ops=function(){var ops=[];return ops[9]=function(){var add16temp=(z80.iyl|z80.iyh<<8)+(z80.c|z80.b<<8),lookup=((z80.iyl|z80.iyh<<8)&2048)>>11|((z80.c|z80.b<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.iyh=add16temp>>8&255;z80.iyl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[25]=function(){var add16temp=(z80.iyl|z80.iyh<<8)+(z80.e|z80.d<<8),lookup=((z80.iyl|z80.iyh<<8)&2048)>>11|((z80.e|z80.d<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.iyh=add16temp>>8&255;z80.iyl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[33]=function(){tstates+=6;z80.iyl=readbyte(z80.pc++);z80.pc&=65535;z80.iyh=readbyte(z80.pc++);z80.pc&=65535},ops[34]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;writebyte(ldtemp++,z80.iyl);ldtemp&=65535;writebyte(ldtemp,z80.iyh)},ops[35]=function(){tstates+=2;var wordtemp=(z80.iyl|z80.iyh<<8)+1&65535;z80.iyh=wordtemp>>8;z80.iyl=wordtemp&255},ops[36]=function(){z80.iyh=z80.iyh+1&255;z80.f=z80.f&1|(z80.iyh==128?4:0)|(z80.iyh&15?0:16)|sz53_table[z80.iyh]},ops[37]=function(){z80.f=z80.f&1|(z80.iyh&15?0:16)|2;z80.iyh=z80.iyh-1&255;z80.f|=(z80.iyh==127?4:0)|sz53_table[z80.iyh]},ops[38]=function(){tstates+=3;z80.iyh=readbyte(z80.pc++);z80.pc&=65535},ops[41]=function(){var add16temp=(z80.iyl|z80.iyh<<8)+(z80.iyl|z80.iyh<<8),lookup=((z80.iyl|z80.iyh<<8)&2048)>>11|((z80.iyl|z80.iyh<<8)&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.iyh=add16temp>>8&255;z80.iyl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[42]=function(){var ldtemp;tstates+=12;ldtemp=readbyte(z80.pc++);z80.pc&=65535;ldtemp|=readbyte(z80.pc++)<<8;z80.pc&=65535;z80.iyl=readbyte(ldtemp++);ldtemp&=65535;z80.iyh=readbyte(ldtemp)},ops[43]=function(){tstates+=2;var wordtemp=(z80.iyl|z80.iyh<<8)-1&65535;z80.iyh=wordtemp>>8;z80.iyl=wordtemp&255},ops[44]=function(){z80.iyl=z80.iyl+1&255;z80.f=z80.f&1|(z80.iyl==128?4:0)|(z80.iyl&15?0:16)|sz53_table[z80.iyl]},ops[45]=function(){z80.f=z80.f&1|(z80.iyl&15?0:16)|2;z80.iyl=z80.iyl-1&255;z80.f|=(z80.iyl==127?4:0)|sz53_table[z80.iyl]},ops[46]=function(){tstates+=3;z80.iyl=readbyte(z80.pc++);z80.pc&=65535},ops[52]=function(){var wordtemp,bytetemp;tstates+=15;wordtemp=(z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;bytetemp=readbyte(wordtemp);bytetemp=bytetemp+1&255;z80.f=z80.f&1|(bytetemp==128?4:0)|(bytetemp&15?0:16)|sz53_table[bytetemp];writebyte(wordtemp,bytetemp)},ops[53]=function(){var wordtemp,bytetemp;tstates+=15;wordtemp=(z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;bytetemp=readbyte(wordtemp);z80.f=z80.f&1|(bytetemp&15?0:16)|2;bytetemp=bytetemp-1&255;z80.f|=(bytetemp==127?4:0)|sz53_table[bytetemp];writebyte(wordtemp,bytetemp)},ops[54]=function(){tstates+=11;var wordtemp=(z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535;z80.pc&=65535;writebyte(wordtemp,readbyte(z80.pc++));z80.pc&=65535},ops[57]=function(){var add16temp=(z80.iyl|z80.iyh<<8)+z80.sp,lookup=((z80.iyl|z80.iyh<<8)&2048)>>11|(z80.sp&2048)>>10|(add16temp&2048)>>9;tstates+=7;z80.iyh=add16temp>>8&255;z80.iyl=add16temp&255;z80.f=z80.f&196|(add16temp&65536?1:0)|add16temp>>8&40|halfcarry_add_table[lookup]},ops[68]=function(){z80.b=z80.iyh},ops[69]=function(){z80.b=z80.iyl},ops[70]=function(){tstates+=11;z80.b=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[76]=function(){z80.c=z80.iyh},ops[77]=function(){z80.c=z80.iyl},ops[78]=function(){tstates+=11;z80.c=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[84]=function(){z80.d=z80.iyh},ops[85]=function(){z80.d=z80.iyl},ops[86]=function(){tstates+=11;z80.d=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[92]=function(){z80.e=z80.iyh},ops[93]=function(){z80.e=z80.iyl},ops[94]=function(){tstates+=11;z80.e=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[96]=function(){z80.iyh=z80.b},ops[97]=function(){z80.iyh=z80.c},ops[98]=function(){z80.iyh=z80.d},ops[99]=function(){z80.iyh=z80.e},ops[100]=function(){},ops[101]=function(){z80.iyh=z80.iyl},ops[102]=function(){tstates+=11;z80.h=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[103]=function(){z80.iyh=z80.a},ops[104]=function(){z80.iyl=z80.b},ops[105]=function(){z80.iyl=z80.c},ops[106]=function(){z80.iyl=z80.d},ops[107]=function(){z80.iyl=z80.e},ops[108]=function(){z80.iyl=z80.iyh},ops[109]=function(){},ops[110]=function(){tstates+=11;z80.l=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[111]=function(){z80.iyl=z80.a},ops[112]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.b);z80.pc&=65535},ops[113]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.c);z80.pc&=65535},ops[114]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.d);z80.pc&=65535},ops[115]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.e);z80.pc&=65535},ops[116]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.h);z80.pc&=65535},ops[117]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.l);z80.pc&=65535},ops[119]=function(){tstates+=11;writebyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535,z80.a);z80.pc&=65535},ops[124]=function(){z80.a=z80.iyh},ops[125]=function(){z80.a=z80.iyl},ops[126]=function(){tstates+=11;z80.a=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535},ops[132]=function(){var addtemp=z80.a+z80.iyh,lookup=(z80.a&136)>>3|(z80.iyh&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[133]=function(){var addtemp=z80.a+z80.iyl,lookup=(z80.a&136)>>3|(z80.iyl&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[134]=function(){var bytetemp,addtemp,lookup;tstates+=11;bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;addtemp=z80.a+bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(addtemp&136)>>1;z80.a=addtemp&255;z80.f=(addtemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[140]=function(){var adctemp=z80.a+z80.iyh+(z80.f&1),lookup=(z80.a&136)>>3|(z80.iyh&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[141]=function(){var adctemp=z80.a+z80.iyl+(z80.f&1),lookup=(z80.a&136)>>3|(z80.iyl&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[142]=function(){var bytetemp,adctemp,lookup;tstates+=11;bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;adctemp=z80.a+bytetemp+(z80.f&1);lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(adctemp&136)>>1;z80.a=adctemp&255;z80.f=(adctemp&256?1:0)|halfcarry_add_table[lookup&7]|overflow_add_table[lookup>>4]|sz53_table[z80.a]},ops[148]=function(){var subtemp=z80.a-z80.iyh,lookup=(z80.a&136)>>3|(z80.iyh&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[149]=function(){var subtemp=z80.a-z80.iyl,lookup=(z80.a&136)>>3|(z80.iyl&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[150]=function(){var bytetemp,subtemp,lookup;tstates+=11;bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;subtemp=z80.a-bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(subtemp&136)>>1;z80.a=subtemp&255;z80.f=(subtemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[156]=function(){var sbctemp=z80.a-z80.iyh-(z80.f&1),lookup=(z80.a&136)>>3|(z80.iyh&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[157]=function(){var sbctemp=z80.a-z80.iyl-(z80.f&1),lookup=(z80.a&136)>>3|(z80.iyl&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[158]=function(){var bytetemp,sbctemp,lookup;tstates+=11;bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;sbctemp=z80.a-bytetemp-(z80.f&1);lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(sbctemp&136)>>1;z80.a=sbctemp&255;z80.f=(sbctemp&256?1:0)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|sz53_table[z80.a]},ops[164]=function(){z80.a&=z80.iyh;z80.f=16|sz53p_table[z80.a]},ops[165]=function(){z80.a&=z80.iyl;z80.f=16|sz53p_table[z80.a]},ops[166]=function(){tstates+=11;var bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a&=bytetemp;z80.f=16|sz53p_table[z80.a]},ops[172]=function(){z80.a^=z80.iyh;z80.f=sz53p_table[z80.a]},ops[173]=function(){z80.a^=z80.iyl;z80.f=sz53p_table[z80.a]},ops[174]=function(){tstates+=11;var bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a^=bytetemp;z80.f=sz53p_table[z80.a]},ops[180]=function(){z80.a|=z80.iyh;z80.f=sz53p_table[z80.a]},ops[181]=function(){z80.a|=z80.iyl;z80.f=sz53p_table[z80.a]},ops[182]=function(){tstates+=11;var bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;z80.a|=bytetemp;z80.f=sz53p_table[z80.a]},ops[188]=function(){var cptemp=z80.a-z80.iyh,lookup=(z80.a&136)>>3|(z80.iyh&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.iyh&40|cptemp&128},ops[189]=function(){var cptemp=z80.a-z80.iyl,lookup=(z80.a&136)>>3|(z80.iyl&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|z80.iyl&40|cptemp&128},ops[190]=function(){var bytetemp,cptemp,lookup;tstates+=11;bytetemp=readbyte((z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++))&65535);z80.pc&=65535;cptemp=z80.a-bytetemp;lookup=(z80.a&136)>>3|(bytetemp&136)>>2|(cptemp&136)>>1;z80.f=(cptemp&256?1:cptemp?0:64)|2|halfcarry_sub_table[lookup&7]|overflow_sub_table[lookup>>4]|bytetemp&40|cptemp&128},ops[203]=function(tempaddr){var opcode3;tstates+=7;tempaddr=(z80.iyl|z80.iyh<<8)+sign_extend(readbyte(z80.pc++));z80.pc&=65535;opcode3=readbyte(z80.pc++);z80.pc&=65535;z80_ddfdcbxx(opcode3,tempaddr)},ops[225]=function(){tstates+=6;z80.iyl=readbyte(z80.sp++);z80.sp&=65535;z80.iyh=readbyte(z80.sp++);z80.sp&=65535},ops[227]=function(){var bytetempl=readbyte(z80.sp),bytetemph=readbyte(z80.sp+1);tstates+=15;writebyte(z80.sp+1,z80.iyh);writebyte(z80.sp,z80.iyl);z80.iyl=bytetempl;z80.iyh=bytetemph},ops[229]=function(){tstates++;tstates+=6;z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.iyh);z80.sp--;z80.sp&=65535;writebyte(z80.sp,z80.iyl)},ops[233]=function(){z80.pc=z80.iyl|z80.iyh<<8},ops[249]=function(){tstates+=2;z80.sp=z80.iyl|z80.iyh<<8},ops[256]=function(){z80.pc--;z80.pc&=65535;z80.r--;z80.r&=127},z80_defaults(ops),ops}();z80_ddfdcb_ops=function(){var ops=[];return ops[0]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.b=(z80.b&127)<<1|z80.b>>7;z80.f=z80.b&1|sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[1]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.c=(z80.c&127)<<1|z80.c>>7;z80.f=z80.c&1|sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[2]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.d=(z80.d&127)<<1|z80.d>>7;z80.f=z80.d&1|sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[3]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.e=(z80.e&127)<<1|z80.e>>7;z80.f=z80.e&1|sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[4]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.h=(z80.h&127)<<1|z80.h>>7;z80.f=z80.h&1|sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[5]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.l=(z80.l&127)<<1|z80.l>>7;z80.f=z80.l&1|sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[6]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);bytetemp=(bytetemp&127)<<1|bytetemp>>7;z80.f=bytetemp&1|sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[7]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.a=(z80.a&127)<<1|z80.a>>7;z80.f=z80.a&1|sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[8]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.f=z80.b&1;z80.b=z80.b>>1|(z80.b&1)<<7;z80.f|=sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[9]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.f=z80.c&1;z80.c=z80.c>>1|(z80.c&1)<<7;z80.f|=sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[10]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.f=z80.d&1;z80.d=z80.d>>1|(z80.d&1)<<7;z80.f|=sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[11]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.f=z80.e&1;z80.e=z80.e>>1|(z80.e&1)<<7;z80.f|=sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[12]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.f=z80.h&1;z80.h=z80.h>>1|(z80.h&1)<<7;z80.f|=sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[13]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.f=z80.l&1;z80.l=z80.l>>1|(z80.l&1)<<7;z80.f|=sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[14]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);z80.f=bytetemp&1;bytetemp=bytetemp>>1|(bytetemp&1)<<7;z80.f|=sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[15]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.f=z80.a&1;z80.a=z80.a>>1|(z80.a&1)<<7;z80.f|=sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[16]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);var rltemp=z80.b;z80.b=(z80.b&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[17]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);var rltemp=z80.c;z80.c=(z80.c&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[18]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);var rltemp=z80.d;z80.d=(z80.d&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[19]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);var rltemp=z80.e;z80.e=(z80.e&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[20]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);var rltemp=z80.h;z80.h=(z80.h&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[21]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);var rltemp=z80.l;z80.l=(z80.l&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[22]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr),rltemp=bytetemp;bytetemp=(bytetemp&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[23]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);var rltemp=z80.a;z80.a=(z80.a&127)<<1|z80.f&1;z80.f=rltemp>>7|sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[24]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);var rrtemp=z80.b;z80.b=z80.b>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[25]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);var rrtemp=z80.c;z80.c=z80.c>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[26]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);var rrtemp=z80.d;z80.d=z80.d>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[27]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);var rrtemp=z80.e;z80.e=z80.e>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[28]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);var rrtemp=z80.h;z80.h=z80.h>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[29]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);var rrtemp=z80.l;z80.l=z80.l>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[30]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr),rrtemp=bytetemp;bytetemp=bytetemp>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[31]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);var rrtemp=z80.a;z80.a=z80.a>>1|(z80.f&1)<<7;z80.f=rrtemp&1|sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[32]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.f=z80.b>>7;z80.b<<=1;z80.b&=255;z80.f|=sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[33]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.f=z80.c>>7;z80.c<<=1;z80.c&=255;z80.f|=sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[34]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.f=z80.d>>7;z80.d<<=1;z80.d&=255;z80.f|=sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[35]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.f=z80.e>>7;z80.e<<=1;z80.e&=255;z80.f|=sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[36]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.f=z80.h>>7;z80.h<<=1;z80.h&=255;z80.f|=sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[37]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.f=z80.l>>7;z80.l<<=1;z80.l&=255;z80.f|=sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[38]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);z80.f=bytetemp>>7;bytetemp<<=1;bytetemp&=255;z80.f|=sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[39]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.f=z80.a>>7;z80.a<<=1;z80.a&=255;z80.f|=sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[40]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.f=z80.b&1;z80.b=z80.b&128|z80.b>>1;z80.f|=sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[41]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.f=z80.c&1;z80.c=z80.c&128|z80.c>>1;z80.f|=sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[42]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.f=z80.d&1;z80.d=z80.d&128|z80.d>>1;z80.f|=sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[43]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.f=z80.e&1;z80.e=z80.e&128|z80.e>>1;z80.f|=sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[44]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.f=z80.h&1;z80.h=z80.h&128|z80.h>>1;z80.f|=sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[45]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.f=z80.l&1;z80.l=z80.l&128|z80.l>>1;z80.f|=sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[46]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);z80.f=bytetemp&1;bytetemp=bytetemp&128|bytetemp>>1;z80.f|=sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[47]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.f=z80.a&1;z80.a=z80.a&128|z80.a>>1;z80.f|=sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[48]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.f=z80.b>>7;z80.b=z80.b<<1|1;z80.b&=255;z80.f|=sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[49]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.f=z80.c>>7;z80.c=z80.c<<1|1;z80.c&=255;z80.f|=sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[50]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.f=z80.d>>7;z80.d=z80.d<<1|1;z80.d&=255;z80.f|=sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[51]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.f=z80.e>>7;z80.e=z80.e<<1|1;z80.e&=255;z80.f|=sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[52]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.f=z80.h>>7;z80.h=z80.h<<1|1;z80.h&=255;z80.f|=sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[53]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.f=z80.l>>7;z80.l=z80.l<<1|1;z80.l&=255;z80.f|=sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[54]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);z80.f=bytetemp>>7;bytetemp=bytetemp<<1|1;bytetemp&=255;z80.f|=sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[55]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.f=z80.a>>7;z80.a=z80.a<<1|1;z80.a&=255;z80.f|=sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[56]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr);z80.f=z80.b&1;z80.b>>=1;z80.f|=sz53p_table[z80.b];writebyte(tempaddr,z80.b)},ops[57]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr);z80.f=z80.c&1;z80.c>>=1;z80.f|=sz53p_table[z80.c];writebyte(tempaddr,z80.c)},ops[58]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr);z80.f=z80.d&1;z80.d>>=1;z80.f|=sz53p_table[z80.d];writebyte(tempaddr,z80.d)},ops[59]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr);z80.f=z80.e&1;z80.e>>=1;z80.f|=sz53p_table[z80.e];writebyte(tempaddr,z80.e)},ops[60]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr);z80.f=z80.h&1;z80.h>>=1;z80.f|=sz53p_table[z80.h];writebyte(tempaddr,z80.h)},ops[61]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr);z80.f=z80.l&1;z80.l>>=1;z80.f|=sz53p_table[z80.l];writebyte(tempaddr,z80.l)},ops[62]=function(tempaddr){tstates+=8;var bytetemp=readbyte(tempaddr);z80.f=bytetemp&1;bytetemp>>=1;z80.f|=sz53p_table[bytetemp];writebyte(tempaddr,bytetemp)},ops[63]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr);z80.f=z80.a&1;z80.a>>=1;z80.f|=sz53p_table[z80.a];writebyte(tempaddr,z80.a)},ops[64]=ops[65]=ops[66]=ops[67]=ops[68]=ops[69]=ops[70]=ops[71]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&1||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[72]=ops[73]=ops[74]=ops[75]=ops[76]=ops[77]=ops[78]=ops[79]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&2||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[80]=ops[81]=ops[82]=ops[83]=ops[84]=ops[85]=ops[86]=ops[87]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&4||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[88]=ops[89]=ops[90]=ops[91]=ops[92]=ops[93]=ops[94]=ops[95]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&8||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[96]=ops[97]=ops[98]=ops[99]=ops[100]=ops[101]=ops[102]=ops[103]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&16||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[104]=ops[105]=ops[106]=ops[107]=ops[108]=ops[109]=ops[110]=ops[111]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&32||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[112]=ops[113]=ops[114]=ops[115]=ops[116]=ops[117]=ops[118]=ops[119]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&64||(z80.f|=68);!1&&bytetemp&128&&(z80.f|=128)},ops[120]=ops[121]=ops[122]=ops[123]=ops[124]=ops[125]=ops[126]=ops[127]=function(tempaddr){tstates+=5;var bytetemp=readbyte(tempaddr);z80.f=z80.f&1|16|tempaddr>>8&40;bytetemp&128||(z80.f|=68);!0&&bytetemp&128&&(z80.f|=128)},ops[128]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&254;writebyte(tempaddr,z80.b)},ops[129]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&254;writebyte(tempaddr,z80.c)},ops[130]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&254;writebyte(tempaddr,z80.d)},ops[131]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&254;writebyte(tempaddr,z80.e)},ops[132]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&254;writebyte(tempaddr,z80.h)},ops[133]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&254;writebyte(tempaddr,z80.l)},ops[134]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&254)},ops[135]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&254;writebyte(tempaddr,z80.a)},ops[136]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&253;writebyte(tempaddr,z80.b)},ops[137]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&253;writebyte(tempaddr,z80.c)},ops[138]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&253;writebyte(tempaddr,z80.d)},ops[139]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&253;writebyte(tempaddr,z80.e)},ops[140]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&253;writebyte(tempaddr,z80.h)},ops[141]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&253;writebyte(tempaddr,z80.l)},ops[142]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&253)},ops[143]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&253;writebyte(tempaddr,z80.a)},ops[144]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&251;writebyte(tempaddr,z80.b)},ops[145]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&251;writebyte(tempaddr,z80.c)},ops[146]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&251;writebyte(tempaddr,z80.d)},ops[147]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&251;writebyte(tempaddr,z80.e)},ops[148]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&251;writebyte(tempaddr,z80.h)},ops[149]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&251;writebyte(tempaddr,z80.l)},ops[150]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&251)},ops[151]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&251;writebyte(tempaddr,z80.a)},ops[152]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&247;writebyte(tempaddr,z80.b)},ops[153]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&247;writebyte(tempaddr,z80.c)},ops[154]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&247;writebyte(tempaddr,z80.d)},ops[155]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&247;writebyte(tempaddr,z80.e)},ops[156]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&247;writebyte(tempaddr,z80.h)},ops[157]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&247;writebyte(tempaddr,z80.l)},ops[158]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&247)},ops[159]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&247;writebyte(tempaddr,z80.a)},ops[160]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&239;writebyte(tempaddr,z80.b)},ops[161]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&239;writebyte(tempaddr,z80.c)},ops[162]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&239;writebyte(tempaddr,z80.d)},ops[163]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&239;writebyte(tempaddr,z80.e)},ops[164]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&239;writebyte(tempaddr,z80.h)},ops[165]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&239;writebyte(tempaddr,z80.l)},ops[166]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&239)},ops[167]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&239;writebyte(tempaddr,z80.a)},ops[168]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&223;writebyte(tempaddr,z80.b)},ops[169]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&223;writebyte(tempaddr,z80.c)},ops[170]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&223;writebyte(tempaddr,z80.d)},ops[171]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&223;writebyte(tempaddr,z80.e)},ops[172]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&223;writebyte(tempaddr,z80.h)},ops[173]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&223;writebyte(tempaddr,z80.l)},ops[174]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&223)},ops[175]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&223;writebyte(tempaddr,z80.a)},ops[176]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&191;writebyte(tempaddr,z80.b)},ops[177]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&191;writebyte(tempaddr,z80.c)},ops[178]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&191;writebyte(tempaddr,z80.d)},ops[179]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&191;writebyte(tempaddr,z80.e)},ops[180]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&191;writebyte(tempaddr,z80.h)},ops[181]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&191;writebyte(tempaddr,z80.l)},ops[182]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&191)},ops[183]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&191;writebyte(tempaddr,z80.a)},ops[184]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)&127;writebyte(tempaddr,z80.b)},ops[185]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)&127;writebyte(tempaddr,z80.c)},ops[186]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)&127;writebyte(tempaddr,z80.d)},ops[187]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)&127;writebyte(tempaddr,z80.e)},ops[188]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)&127;writebyte(tempaddr,z80.h)},ops[189]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)&127;writebyte(tempaddr,z80.l)},ops[190]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)&127)},ops[191]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)&127;writebyte(tempaddr,z80.a)},ops[192]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|1;writebyte(tempaddr,z80.b)},ops[193]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|1;writebyte(tempaddr,z80.c)},ops[194]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|1;writebyte(tempaddr,z80.d)},ops[195]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|1;writebyte(tempaddr,z80.e)},ops[196]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|1;writebyte(tempaddr,z80.h)},ops[197]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|1;writebyte(tempaddr,z80.l)},ops[198]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|1)},ops[199]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|1;writebyte(tempaddr,z80.a)},ops[200]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|2;writebyte(tempaddr,z80.b)},ops[201]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|2;writebyte(tempaddr,z80.c)},ops[202]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|2;writebyte(tempaddr,z80.d)},ops[203]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|2;writebyte(tempaddr,z80.e)},ops[204]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|2;writebyte(tempaddr,z80.h)},ops[205]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|2;writebyte(tempaddr,z80.l)},ops[206]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|2)},ops[207]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|2;writebyte(tempaddr,z80.a)},ops[208]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|4;writebyte(tempaddr,z80.b)},ops[209]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|4;writebyte(tempaddr,z80.c)},ops[210]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|4;writebyte(tempaddr,z80.d)},ops[211]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|4;writebyte(tempaddr,z80.e)},ops[212]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|4;writebyte(tempaddr,z80.h)},ops[213]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|4;writebyte(tempaddr,z80.l)},ops[214]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|4)},ops[215]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|4;writebyte(tempaddr,z80.a)},ops[216]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|8;writebyte(tempaddr,z80.b)},ops[217]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|8;writebyte(tempaddr,z80.c)},ops[218]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|8;writebyte(tempaddr,z80.d)},ops[219]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|8;writebyte(tempaddr,z80.e)},ops[220]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|8;writebyte(tempaddr,z80.h)},ops[221]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|8;writebyte(tempaddr,z80.l)},ops[222]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|8)},ops[223]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|8;writebyte(tempaddr,z80.a)},ops[224]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|16;writebyte(tempaddr,z80.b)},ops[225]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|16;writebyte(tempaddr,z80.c)},ops[226]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|16;writebyte(tempaddr,z80.d)},ops[227]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|16;writebyte(tempaddr,z80.e)},ops[228]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|16;writebyte(tempaddr,z80.h)},ops[229]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|16;writebyte(tempaddr,z80.l)},ops[230]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|16)},ops[231]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|16;writebyte(tempaddr,z80.a)},ops[232]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|32;writebyte(tempaddr,z80.b)},ops[233]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|32;writebyte(tempaddr,z80.c)},ops[234]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|32;writebyte(tempaddr,z80.d)},ops[235]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|32;writebyte(tempaddr,z80.e)},ops[236]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|32;writebyte(tempaddr,z80.h)},ops[237]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|32;writebyte(tempaddr,z80.l)},ops[238]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|32)},ops[239]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|32;writebyte(tempaddr,z80.a)},ops[240]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|64;writebyte(tempaddr,z80.b)},ops[241]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|64;writebyte(tempaddr,z80.c)},ops[242]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|64;writebyte(tempaddr,z80.d)},ops[243]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|64;writebyte(tempaddr,z80.e)},ops[244]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|64;writebyte(tempaddr,z80.h)},ops[245]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|64;writebyte(tempaddr,z80.l)},ops[246]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|64)},ops[247]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|64;writebyte(tempaddr,z80.a)},ops[248]=function(tempaddr){tstates+=8;z80.b=readbyte(tempaddr)|128;writebyte(tempaddr,z80.b)},ops[249]=function(tempaddr){tstates+=8;z80.c=readbyte(tempaddr)|128;writebyte(tempaddr,z80.c)},ops[250]=function(tempaddr){tstates+=8;z80.d=readbyte(tempaddr)|128;writebyte(tempaddr,z80.d)},ops[251]=function(tempaddr){tstates+=8;z80.e=readbyte(tempaddr)|128;writebyte(tempaddr,z80.e)},ops[252]=function(tempaddr){tstates+=8;z80.h=readbyte(tempaddr)|128;writebyte(tempaddr,z80.h)},ops[253]=function(tempaddr){tstates+=8;z80.l=readbyte(tempaddr)|128;writebyte(tempaddr,z80.l)},ops[254]=function(tempaddr){tstates+=8;writebyte(tempaddr,readbyte(tempaddr)|128)},ops[255]=function(tempaddr){tstates+=8;z80.a=readbyte(tempaddr)|128;writebyte(tempaddr,z80.a)},ops[256]=function(){},z80_defaults(ops),ops}();var vram=[],vramUntwiddled=[],vdp_regs=[],palette=[],paletteR=[],paletteG=[],paletteB=[],paletteRGB=[],vdp_addr_state=0,vdp_mode_select=0,vdp_addr_latch=0,vdp_addr=0,vdp_current_line=0,vdp_status=0,vdp_pending_hblank=!1,vdp_hblank_counter=0;prev_border=null;borderColourCss=null;currentFrame=1;var ram=[],cartridgeRam=[],romBanks=[],pages=[],ramSelectRegister=0,romPageMask=0,canvas,ctx,imageData,fb8,fb32,joystick=65535,inputMode=0,soundChip,initialized=!1,framesPerSecond=50,scanLinesPerFrame=313,scanLinesPerSecond=scanLinesPerFrame*framesPerSecond,cpuHz=358e4,tstatesPerHblank=Math.ceil(cpuHz/scanLinesPerSecond)|0,event_next_event=tstatesPerHblank,tstates=0;var targetTimeout=1e3/framesPerSecond,pausedTimeout=2*targetTimeout,linesPerYield=20,lastFrame=Date.now(),cycles=0,cyclet=0;audioContext=null;keys={87:1,83:2,65:4,68:8,32:16,13:32,38:1,40:2,37:4,39:8,90:16,88:32,82:4096};running=!1;currentRom=0;window.nipplejs=function(){"use strict";function Super(){}function Nipple(collection,options){return this.identifier=options.identifier,this.position=options.position,this.frontPosition=options.frontPosition,this.collection=collection,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(options),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Nipple.id,Nipple.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function Collection(manager,options){var self=this;return self.nipples=[],self.idles=[],self.actives=[],self.ids=[],self.pressureIntervals={},self.manager=manager,self.id=Collection.id,Collection.id+=1,self.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},self.config(options),(self.options.mode==="static"||self.options.mode==="semi")&&(self.options.multitouch=!1),self.options.multitouch||(self.options.maxNumberOfNipples=1),self.updateBox(),self.prepareNipples(),self.bindings(),self.begin(),self.nipples}function Manager(options){var self=this,resizeTimer;return self.ids={},self.index=0,self.collections=[],self.config(options),self.prepareCollections(),u.bindEvt(window,"resize",function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var pos,scroll=u.getScroll();self.collections.forEach(function(collection){collection.forEach(function(nipple){pos=nipple.el.getBoundingClientRect();nipple.position={x:scroll.x+pos.left,y:scroll.y+pos.top}})})},100)}),self.collections}var isTouch=!!("ontouchstart"in window),isPointer=window.PointerEvent?!0:!1,isMSPointer=window.MSPointerEvent?!0:!1,events={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},toBind,secondBind={},u,factory;return isPointer?toBind=events.pointer:isMSPointer?toBind=events.MSPointer:isTouch?(toBind=events.touch,secondBind=events.mouse):toBind=events.mouse,u={},u.distance=function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)},u.angle=function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return u.degrees(Math.atan2(dy,dx))},u.findCoord=function(p,d,a){var b={x:0,y:0};return a=u.radians(a),b.x=p.x-d*Math.cos(a),b.y=p.y-d*Math.sin(a),b},u.radians=function(a){return a*(Math.PI/180)},u.degrees=function(a){return a*(180/Math.PI)},u.bindEvt=function(el,arg,handler){for(var types=arg.split(/[ ,]+/g),type,i=0;i<types.length;i+=1)type=types[i],el.addEventListener?el.addEventListener(type,handler,!1):el.attachEvent&&el.attachEvent(type,handler)},u.unbindEvt=function(el,arg,handler){for(var types=arg.split(/[ ,]+/g),type,i=0;i<types.length;i+=1)type=types[i],el.removeEventListener?el.removeEventListener(type,handler):el.detachEvent&&el.detachEvent(type,handler)},u.trigger=function(el,type,data){var evt=new CustomEvent(type,data);el.dispatchEvent(evt)},u.prepareEvent=function(evt){return evt.stopPropagation(),evt.preventDefault(),evt.type.match(/^touch/)?evt.changedTouches:evt},u.getScroll=function(){var x=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:x,y:y}},u.applyPosition=function(el,pos){pos.top||pos.right||pos.bottom||pos.left?(el.style.top=pos.top,el.style.right=pos.right,el.style.bottom=pos.bottom,el.style.left=pos.left):(el.style.left=pos.x+"px",el.style.top=pos.y+"px")},u.getTransitionStyle=function(property,values,time){var obj=u.configStylePropertyObject(property),i,st,j,max;for(i in obj)if(obj.hasOwnProperty(i))if(typeof values=="string")obj[i]=values+" "+time;else{for(st="",j=0,max=values.length;j<max;j+=1)st+=values[j]+" "+time+", ";obj[i]=st.slice(0,-2)}return obj},u.getVendorStyle=function(property,value){var obj=u.configStylePropertyObject(property);for(var i in obj)obj.hasOwnProperty(i)&&(obj[i]=value);return obj},u.configStylePropertyObject=function(prop){var obj={},vendors;return obj[prop]="",vendors=["webkit","Moz","o"],vendors.forEach(function(vendor){obj[vendor+prop.charAt(0).toUpperCase()+prop.slice(1)]=""}),obj},u.extend=function(objA,objB){for(var i in objB)objB.hasOwnProperty(i)&&(objA[i]=objB[i]);return objA},u.safeExtend=function(objA,objB){var obj={};for(var i in objA)objA.hasOwnProperty(i)&&objB.hasOwnProperty(i)?obj[i]=objB[i]:objA.hasOwnProperty(i)&&(obj[i]=objA[i]);return obj},u.map=function(ar,fn){if(ar.length)for(var i=0,max=ar.length;i<max;i+=1)fn(ar[i]);else fn(ar)},Super.prototype.on=function(arg,cb){var self=this,types=arg.split(/[ ,]+/g),type,i;for(self._handlers_=self._handlers_||{},i=0;i<types.length;i+=1)type=types[i],self._handlers_[type]=self._handlers_[type]||[],self._handlers_[type].push(cb);return self},Super.prototype.off=function(type,cb){var self=this;return self._handlers_=self._handlers_||{},type===undefined?self._handlers_={}:cb===undefined?self._handlers_[type]=null:self._handlers_[type]&&self._handlers_[type].indexOf(cb)>=0&&self._handlers_[type].splice(self._handlers_[type].indexOf(cb),1),self},Super.prototype.trigger=function(arg,data){var self=this,types=arg.split(/[ ,]+/g),type,i;for(self._handlers_=self._handlers_||{},i=0;i<types.length;i+=1)type=types[i],self._handlers_[type]&&self._handlers_[type].length&&self._handlers_[type].forEach(function(handler){handler.call(self,{type:type,target:self},data)})},Super.prototype.config=function(options){var self=this;self.options=self.defaults||{};options&&(self.options=u.safeExtend(self.options,options))},Super.prototype.bindEvt=function(el,type){var self=this;return self._domHandlers_=self._domHandlers_||{},self._domHandlers_[type]=function(){typeof self["on"+type]=="function"?self["on"+type].apply(self,arguments):console.warn('[WARNING] : Missing "on'+type+'" handler.')},u.bindEvt(el,toBind[type],self._domHandlers_[type]),secondBind[type]&&u.bindEvt(el,secondBind[type],self._domHandlers_[type]),self},Super.prototype.unbindEvt=function(el,type){var self=this;return self._domHandlers_=self._domHandlers_||{},u.unbindEvt(el,toBind[type],self._domHandlers_[type]),secondBind[type]&&u.unbindEvt(el,secondBind[type],self._domHandlers_[type]),delete self._domHandlers_[type],this},Nipple.prototype=new Super,Nipple.constructor=Nipple,Nipple.id=0,Nipple.prototype.buildEl=function(){return(this.ui={},this.options.dataOnly)?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},Nipple.prototype.stylize=function(){if(this.options.dataOnly)return this;var animTime=this.options.fadeTime+"ms",borderStyle=u.getVendorStyle("borderRadius","50%"),transitStyle=u.getTransitionStyle("transition","opacity",animTime),styles={};return styles.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},styles.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},styles.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},u.extend(styles.el,transitStyle),u.extend(styles.back,borderStyle),u.extend(styles.front,borderStyle),this.applyStyles(styles),this},Nipple.prototype.applyStyles=function(styles){var i,j;for(i in this.ui)if(this.ui.hasOwnProperty(i))for(j in styles[i])this.ui[i].style[j]=styles[i][j];return this},Nipple.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},Nipple.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},Nipple.prototype.destroy=function(){clearTimeout(this.removeTimeout);clearTimeout(this.showTimeout);clearTimeout(this.restTimeout);this.trigger("destroyed",this.instance);this.removeFromDom();this.off()},Nipple.prototype.show=function(cb){var self=this;return self.options.dataOnly?self:(clearTimeout(self.removeTimeout),clearTimeout(self.showTimeout),clearTimeout(self.restTimeout),self.addToDom(),self.restCallback(),setTimeout(function(){self.ui.el.style.opacity=1},0),self.showTimeout=setTimeout(function(){self.trigger("shown",self.instance);typeof cb=="function"&&cb.call(this)},self.options.fadeTime),self)},Nipple.prototype.hide=function(cb){var self=this;return self.options.dataOnly?self:(self.ui.el.style.opacity=self.options.restOpacity,clearTimeout(self.removeTimeout),clearTimeout(self.showTimeout),clearTimeout(self.restTimeout),self.removeTimeout=setTimeout(function(){var display=self.options.mode==="dynamic"?"none":"block";self.ui.el.style.display=display;typeof cb=="function"&&cb.call(self);self.trigger("hidden",self.instance)},self.options.fadeTime),self.options.restJoystick&&self.restPosition(),self)},Nipple.prototype.restPosition=function(cb){var self=this,animTime,transitStyle,styles;self.frontPosition={x:0,y:0};animTime=self.options.fadeTime+"ms";transitStyle={};transitStyle.front=u.getTransitionStyle("transition",["top","left"],animTime);styles={front:{}};styles.front={left:self.frontPosition.x+"px",top:self.frontPosition.y+"px"};self.applyStyles(transitStyle);self.applyStyles(styles);self.restTimeout=setTimeout(function(){typeof cb=="function"&&cb.call(self);self.restCallback()},self.options.fadeTime)},Nipple.prototype.restCallback=function(){var self=this,transitStyle={};transitStyle.front=u.getTransitionStyle("transition","none","");self.applyStyles(transitStyle);self.trigger("rested",self.instance)},Nipple.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Nipple.prototype.computeDirection=function(obj){var rAngle=obj.angle.radian,angle45=Math.PI/4,angle90=Math.PI/2,direction,directionX,directionY,oldDirection,i,same;if(rAngle>angle45&&rAngle<angle45*3&&!obj.lockX?direction="up":rAngle>-angle45&&rAngle<=angle45&&!obj.lockY?direction="left":rAngle>-angle45*3&&rAngle<=-angle45&&!obj.lockX?direction="down":obj.lockY||(direction="right"),obj.lockY||(directionX=rAngle>-angle90&&rAngle<angle90?"left":"right"),obj.lockX||(directionY=rAngle>0?"up":"down"),obj.force>this.options.threshold){oldDirection={};for(i in this.direction)this.direction.hasOwnProperty(i)&&(oldDirection[i]=this.direction[i]);same={};this.direction={x:directionX,y:directionY,angle:direction};obj.direction=this.direction;for(i in oldDirection)oldDirection[i]===this.direction[i]&&(same[i]=!0);if(same.x&&same.y&&same.angle)return obj;same.x&&same.y||this.trigger("plain",obj);same.x||this.trigger("plain:"+directionX,obj);same.y||this.trigger("plain:"+directionY,obj);same.angle||this.trigger("dir dir:"+direction,obj)}return obj},Collection.prototype=new Super,Collection.constructor=Collection,Collection.id=0,Collection.prototype.prepareNipples=function(){var self=this,nips=self.nipples;nips.on=self.on.bind(self);nips.off=self.off.bind(self);nips.options=self.options;nips.destroy=self.destroy.bind(self);nips.ids=self.ids;nips.id=self.id;nips.processOnMove=self.processOnMove.bind(self);nips.processOnEnd=self.processOnEnd.bind(self);nips.get=function(id){if(id===undefined)return nips[0];for(var i=0,max=nips.length;i<max;i+=1)if(nips[i].identifier===id)return nips[i];return!1}},Collection.prototype.bindings=function(){var self=this;self.bindEvt(self.options.zone,"start");self.options.zone.style.touchAction="none";self.options.zone.style.msTouchAction="none"},Collection.prototype.begin=function(){var self=this,opts=self.options,nipple;opts.mode==="static"&&(nipple=self.createNipple(opts.position,self.manager.getIdentifier()),nipple.add(),self.idles.push(nipple))},Collection.prototype.createNipple=function(position,identifier){var self=this,scroll=u.getScroll(),toPutOn={},opts=self.options,dumb,dumbBox,nipple;return position.x&&position.y?toPutOn={x:position.x-(scroll.x+self.box.left),y:position.y-(scroll.y+self.box.top)}:(position.top||position.right||position.bottom||position.left)&&(dumb=document.createElement("DIV"),dumb.style.display="hidden",dumb.style.top=position.top,dumb.style.right=position.right,dumb.style.bottom=position.bottom,dumb.style.left=position.left,dumb.style.position="absolute",opts.zone.appendChild(dumb),dumbBox=dumb.getBoundingClientRect(),opts.zone.removeChild(dumb),toPutOn=position,position={x:dumbBox.left+scroll.x,y:dumbBox.top+scroll.y}),nipple=new Nipple(self,{color:opts.color,size:opts.size,threshold:opts.threshold,fadeTime:opts.fadeTime,dataOnly:opts.dataOnly,restJoystick:opts.restJoystick,restOpacity:opts.restOpacity,mode:opts.mode,identifier:identifier,position:position,zone:opts.zone,frontPosition:{x:0,y:0}}),opts.dataOnly||(u.applyPosition(nipple.ui.el,toPutOn),u.applyPosition(nipple.ui.front,nipple.frontPosition)),self.nipples.push(nipple),self.trigger("added "+nipple.identifier+":added",nipple),self.manager.trigger("added "+nipple.identifier+":added",nipple),self.bindNipple(nipple),nipple},Collection.prototype.updateBox=function(){var self=this;self.box=self.options.zone.getBoundingClientRect()},Collection.prototype.bindNipple=function(nipple){var self=this,type,handler=function(evt,data){type=evt.type+" "+data.id+":"+evt.type;self.trigger(type,data)};nipple.on("destroyed",self.onDestroyed.bind(self));nipple.on("shown hidden rested dir plain",handler);nipple.on("dir:up dir:right dir:down dir:left",handler);nipple.on("plain:up plain:right plain:down plain:left",handler)},Collection.prototype.pressureFn=function(touch,nipple,identifier){var self=this,previousPressure=0;clearInterval(self.pressureIntervals[identifier]);self.pressureIntervals[identifier]=setInterval(function(){var pressure=touch.force||touch.pressure||touch.webkitForce||0;pressure!==previousPressure&&(nipple.trigger("pressure",pressure),self.trigger("pressure "+nipple.identifier+":pressure",pressure),previousPressure=pressure)}.bind(self),100)},Collection.prototype.onstart=function(evt){var self=this,opts=self.options,process;return evt=u.prepareEvent(evt),self.updateBox(),process=function(touch){self.actives.length<opts.maxNumberOfNipples&&self.processOnStart(touch)},u.map(evt,process),self.manager.bindDocument(),!1},Collection.prototype.processOnStart=function(evt){var self=this,opts=self.options,indexInIdles,identifier=self.manager.getIdentifier(evt),pressure=evt.force||evt.pressure||evt.webkitForce||0,position={x:evt.pageX,y:evt.pageY},nipple=self.getOrCreate(identifier,position),process,distance;if(nipple.identifier!==identifier&&self.manager.removeIdentifier(nipple.identifier),nipple.identifier=identifier,process=function(nip){nip.trigger("start",nip);self.trigger("start "+nip.id+":start",nip);nip.show();pressure>0&&self.pressureFn(evt,nip,nip.identifier);self.processOnMove(evt)},(indexInIdles=self.idles.indexOf(nipple))>=0&&self.idles.splice(indexInIdles,1),self.actives.push(nipple),self.ids.push(nipple.identifier),opts.mode!=="semi")process(nipple);else if(distance=u.distance(position,nipple.position),distance<=opts.catchDistance)process(nipple);else{nipple.destroy();self.processOnStart(evt);return}return nipple},Collection.prototype.getOrCreate=function(identifier,position){var self=this,opts=self.options,nipple;return/(semi|static)/.test(opts.mode)?(nipple=self.idles[0],nipple)?(self.idles.splice(0,1),nipple):opts.mode==="semi"?self.createNipple(position,identifier):(console.warn("Coudln't find the needed nipple."),!1):self.createNipple(position,identifier)},Collection.prototype.processOnMove=function(evt){var self=this,opts=self.options,identifier=self.manager.getIdentifier(evt),nipple=self.nipples.get(identifier),xPosition,yPosition,toSend;if(!nipple){console.error("Found zombie joystick with ID "+identifier);self.manager.removeIdentifier(identifier);return}nipple.identifier=identifier;var size=nipple.options.size/2,pos={x:evt.pageX,y:evt.pageY},dist=u.distance(pos,nipple.position),angle=u.angle(pos,nipple.position),rAngle=u.radians(angle),force=dist/size;dist>size&&(dist=size,pos=u.findCoord(nipple.position,dist,angle));xPosition=pos.x-nipple.position.x;yPosition=pos.y-nipple.position.y;opts.lockX&&(yPosition=0);opts.lockY&&(xPosition=0);nipple.frontPosition={x:xPosition,y:yPosition};opts.dataOnly||u.applyPosition(nipple.ui.front,nipple.frontPosition);toSend={identifier:nipple.identifier,position:pos,force:force,pressure:evt.force||evt.pressure||evt.webkitForce||0,distance:dist,angle:{radian:rAngle,degree:angle},instance:nipple,lockX:opts.lockX,lockY:opts.lockY};toSend=nipple.computeDirection(toSend);toSend.angle={radian:u.radians(180-angle),degree:180-angle};nipple.trigger("move",toSend);self.trigger("move "+nipple.id+":move",toSend)},Collection.prototype.processOnEnd=function(evt){var self=this,opts=self.options,identifier=self.manager.getIdentifier(evt),nipple=self.nipples.get(identifier),removedIdentifier=self.manager.removeIdentifier(nipple.identifier);nipple&&(opts.dataOnly||nipple.hide(function(){opts.mode==="dynamic"&&(nipple.trigger("removed",nipple),self.trigger("removed "+nipple.id+":removed",nipple),self.manager.trigger("removed "+nipple.id+":removed",nipple),nipple.destroy())}),clearInterval(self.pressureIntervals[nipple.identifier]),nipple.resetDirection(),nipple.trigger("end",nipple),self.trigger("end "+nipple.id+":end",nipple),self.ids.indexOf(nipple.identifier)>=0&&self.ids.splice(self.ids.indexOf(nipple.identifier),1),self.actives.indexOf(nipple)>=0&&self.actives.splice(self.actives.indexOf(nipple),1),/(semi|static)/.test(opts.mode)?self.idles.push(nipple):self.nipples.indexOf(nipple)>=0&&self.nipples.splice(self.nipples.indexOf(nipple),1),self.manager.unbindDocument(),/(semi|static)/.test(opts.mode)&&(self.manager.ids[removedIdentifier.id]=removedIdentifier.identifier))},Collection.prototype.onDestroyed=function(evt,nipple){var self=this;self.nipples.indexOf(nipple)>=0&&self.nipples.splice(self.nipples.indexOf(nipple),1);self.actives.indexOf(nipple)>=0&&self.actives.splice(self.actives.indexOf(nipple),1);self.idles.indexOf(nipple)>=0&&self.idles.splice(self.idles.indexOf(nipple),1);self.ids.indexOf(nipple.identifier)>=0&&self.ids.splice(self.ids.indexOf(nipple.identifier),1);self.manager.removeIdentifier(nipple.identifier);self.manager.unbindDocument()},Collection.prototype.destroy=function(){var self=this,i;self.unbindEvt(self.options.zone,"start");self.nipples.forEach(function(nipple){nipple.destroy()});for(i in self.pressureIntervals)self.pressureIntervals.hasOwnProperty(i)&&clearInterval(self.pressureIntervals[i]);self.trigger("destroyed",self.nipples);self.manager.unbindDocument();self.off()},Manager.prototype=new Super,Manager.constructor=Manager,Manager.prototype.prepareCollections=function(){var self=this;self.collections.create=self.create.bind(self);self.collections.on=self.on.bind(self);self.collections.off=self.off.bind(self);self.collections.destroy=self.destroy.bind(self);self.collections.get=function(id){var nipple;return self.collections.every(function(collection){return(nipple=collection.get(id))?!1:!0}),nipple}},Manager.prototype.create=function(options){return this.createCollection(options)},Manager.prototype.createCollection=function(options){var self=this,collection=new Collection(self,options);return self.bindCollection(collection),self.collections.push(collection),collection},Manager.prototype.bindCollection=function(collection){var self=this,type,handler=function(evt,data){type=evt.type+" "+data.id+":"+evt.type;self.trigger(type,data)};collection.on("destroyed",self.onDestroyed.bind(self));collection.on("shown hidden rested dir plain",handler);collection.on("dir:up dir:right dir:down dir:left",handler);collection.on("plain:up plain:right plain:down plain:left",handler)},Manager.prototype.bindDocument=function(){var self=this;self.binded||(self.bindEvt(document,"move").bindEvt(document,"end"),self.binded=!0)},Manager.prototype.unbindDocument=function(force){var self=this;Object.keys(self.ids).length&&force!==!0||(self.unbindEvt(document,"move").unbindEvt(document,"end"),self.binded=!1)},Manager.prototype.getIdentifier=function(evt){var id;return evt?(id=evt.identifier===undefined?evt.pointerId:evt.identifier,id===undefined&&(id=this.latest||0)):id=this.index,this.ids[id]===undefined&&(this.ids[id]=this.index,this.index+=1),this.latest=id,this.ids[id]},Manager.prototype.removeIdentifier=function(identifier){var removed={};for(var id in this.ids)if(this.ids[id]===identifier){removed.id=id;removed.identifier=this.ids[id];delete this.ids[id];break}return removed},Manager.prototype.onmove=function(evt){var self=this;self.onAny("move",evt);return!1},Manager.prototype.onend=function(evt){var self=this;self.onAny("end",evt);return!1},Manager.prototype.oncancel=function(evt){var self=this;self.onAny("end",evt);return!1},Manager.prototype.onAny=function(which,evt){var self=this,id,processFn="processOn"+which.charAt(0).toUpperCase()+which.slice(1),processColl,processEvt;return evt=u.prepareEvent(evt),processColl=function(e,id,coll){coll.ids.indexOf(id)>=0&&(coll[processFn](e),e._found_=!0)},processEvt=function(e){id=self.getIdentifier(e);u.map(self.collections,processColl.bind(null,e,id));e._found_||self.removeIdentifier(id)},u.map(evt,processEvt),!1},Manager.prototype.destroy=function(){var self=this;self.unbindDocument(!0);self.ids={};self.index=0;self.collections.forEach(function(collection){collection.destroy()});self.off()},Manager.prototype.onDestroyed=function(evt,coll){var self=this;if(self.collections.indexOf(coll)<0)return!1;self.collections.splice(self.collections.indexOf(coll),1)},factory=new Manager,{create:function(options){return factory.create(options)},factory:factory}}(),function(){"use strict";function createMouseAndTouchControls(){x.addClickHandler("#trig-audio",function(e){return audio_enable(!0),x.display("#trig-audio",!1),x.display("#trig-no-audio"),x.cancelEvent(e)});x.addClickHandler("#trig-no-audio",function(e){return audio_enable(!1),x.display("#trig-audio"),x.display("#trig-no-audio",!1),x.cancelEvent(e)});x.addClickHandler("#trig-load",function(e){return loadNextRom(),x.cancelEvent(e)});x.addClickHandler("#trig-pause",function(e){return z80_nmi(),x.cancelEvent(e)});x.addClickHandler("#trig-reset",function(e){return reset(),x.cancelEvent(e)})}function createTouchControls(){var stickOptions={zone:document.getElementById("dpad-area"),color:"#ddd",mode:"dynamic"};nipplejs.create(stickOptions).on("dir:up",function(){joystick&=-2;joystick|=2}).on("dir:down",function(){joystick&=-3;joystick|=1}).on("dir:left",function(){joystick&=-5;joystick|=8}).on("dir:right",function(){joystick&=-9;joystick|=4}).on("end",function(){joystick|=15});x.addEventHandler(window,"document",function(e){nipple.processOnEnd(e)});x.addPressReleaseHandlers("#trig1-area",function(){joystick&=-17},function(){joystick|=16});x.addPressReleaseHandlers("#trig2-area",function(){joystick&=-33},function(){joystick|=32})}var x=global.x;x.versions.push(VERSION);console.log(document.childNodes[1].textContent);console.log(VERSION);x.extendClass(x.Game,global,"Shinobi",x.noop,function(proto){var GW=256,GH=192,GR=GH/GW;proto.initialize=function(){if(!("Uint8Array"in window)||!("XMLHttpRequest"in window)||!("overrideMimeType"in XMLHttpRequest.prototype))return this.blue(":/ please move to a modern browser");this.view=document.getElementById("game-view");this.view.width=GW;this.view.height=GH;x.text("#title-text",document.childNodes[1].textContent);x.text("#versn-text",VERSION);x.text("#instr-text","* * * TOUCH HERE or PRESS A BUTTON or TYPE A KEY to START * * *");x.displayLayout()};proto.go=function(){var l=document.getElementById("title-play");this.onFirstInput(l,{keyboard:!0,touch:!0},function(choice){l.style.display="none";choice.keyboard&&(x.html("#keyboard-keys",strings.PlayerKeys+"<br>"+strings.ConsoleKeys),x.display("#keyboard-keys"));choice.touch&&(x.display("#touch-triggers"),createMouseAndTouchControls(),createTouchControls());x.debug||x.app.fullScreen();go()})};proto.layout=function(width,height){x.write(width+"x"+height);var vgw,vgh,ratio=height/width;ratio>GR?(vgw=width,vgh=Math.floor(width*GR)):(vgw=Math.floor(height/GR),vgh=height);this.view.style.width=vgw+"px";this.view.style.height=vgh+"px"};proto.resume=function(){};proto.suspend=function(){}});Shinobi()}();