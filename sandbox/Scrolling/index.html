<!doctype html>

<!-----------------------------------------------------------------------------
 |
 | Copyright (c) Matussi. All rights reserved.
 |
 ----------------------------------------------------------------------------->

<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="favicon.ico">
    <link rel="shortcut icon" href="favicon.ico">
    <script src="js/pixi.min.js"></script>
    <style>
html {
    background-color: white;
}
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
}
    </style>
</head>
<body>
    <noscript>:/ no javascript?!</noscript>
    <script>
        var logger = (function () {
            var instance = {};
            instance.enabled = false;
            instance.log = function (args) {
                if (instance.enabled) {
                    console.log.apply(null, arguments);
                }
            };
            return instance;
        })();

        var app = new PIXI.Application();
        app.view.style.width = "100%";
        app.view.style.height = "100%";
        resize();
        document.body.appendChild(app.view);

        var background, sidebar, fader, pausetext, pausebutton;
        var paused = false;

        PIXI.loader
            .add("background", "assets/background.jpg")
            .add("sidebar", "assets/sidebar.jpg")
            .on("progress", function (loader, resource) {
                // todo:
                // display progress using 
                // loader.loading and loader.progress
            })
            .load(function (loader, resources) {
                background = new PIXI.Sprite(resources.background.texture);

                app.stage.addChild(background);

                sidebar = new PIXI.Sprite(resources.sidebar.texture);
                sidebar.x = app.renderer.width - sidebar.width;

                app.stage.addChild(sidebar);

                var graphics = new PIXI.Graphics();
                graphics.lineStyle(0);
                graphics.beginFill(0, 0);
                graphics.drawRect(0, 0, 236, 110);
                graphics.endFill();

                graphics.x = sidebar.x;
                graphics.y = 480;

                graphics.interactive = true;
                graphics.buttonMode = true;
                graphics.on("click", pause);
                graphics.on("touchend", pause);

                app.stage.addChild(graphics);

                pausebutton = graphics;

                gameloop();
            });

        var scrollStep = 5; scrollToRight = true;

        function gameloop() {
            if (paused) {
                return;
            }
            logger.log("Game Loop");

            if (scrollToRight === true) {
                if (background.x + background.width - scrollStep < app.renderer.width - sidebar.width) {
                    scrollToRight = false;
                }
                else {
                    background.x -= scrollStep;
                }
            }
            else {
                if (background.x + scrollStep > 0) {
                    scrollToRight = true;
                }
                else {
                    background.x += scrollStep;
                }
            }
            
            requestAnimationFrame(gameloop);
        }

        function pause() {
            if (paused) {
                return;
            }
            logger.log("Pause");

            app.ticker.stop();
            paused = true;

            var graphics = new PIXI.Graphics();
            graphics.lineStyle(0);
            graphics.beginFill(0x0000C0, 0.75);
            graphics.drawRect(0, 0, app.view.width, app.view.height);
            graphics.endFill();

            graphics.interactive = true;
            graphics.buttonMode = true;
            graphics.once("click", resume);
            graphics.once("touchend", resume);

            app.stage.addChild(graphics);

            var style = new PIXI.TextStyle({
                fontFamily: 'Arial',
                fontSize: 36,
                fontStyle: 'normal',
                fontWeight: 'bold',
                fill: ['#ffffff', '#00ff99'], // gradient
                stroke: '#4a1850',
                strokeThickness: 5,
                dropShadow: true,
                dropShadowColor: '#000000',
                dropShadowBlur: 4,
                dropShadowAngle: Math.PI / 6,
                dropShadowDistance: 6,
                wordWrap: true,
                wordWrapWidth: 440
            });

            var text = new PIXI.Text('Pause', style);
            text.x = (app.view.width - text.width) /2;
            text.y = (app.view.height - text.height) / 2;

            app.stage.addChild(text);

            app.render();

            fader = graphics;
            pausetext = text;
        }

        function resume() {
            if (!paused) {
                return;
            }
            logger.log("Resume");

            app.stage.removeChild(pausetext);
            app.stage.removeChild(fader);
            app.render();

            fader.destroy(true);
            pausetext.destroy(true);

            app.ticker.start();
            paused = false;
            gameloop();
        }

        function resize() {
            var minW = 800, minH = 700, w, h;
            if (window.innerWidth > minW) {
                // make ratio: iW : iH = w : minH => w = (iW * minH) / iH
                h = minH;
                w = (window.innerWidth * h) / window.innerHeight;
            }
            else {
                // make ratio: iW : iH = minW : h => h = (iH * minW) / iW
                w = minW;
                h = (window.innerHeight * w) / window.innerWidth;
            }
            app.renderer.resize(w, h);
            logger.log(
                app.view.width + " " + app.view.height + " " +
                app.renderer.width + " " + app.renderer.height
            );
            if (sidebar) {
                sidebar.x = app.renderer.width - sidebar.width;
                pausebutton.x = sidebar.x;
            }
        };

        window.onblur = function (evt) {
            pause();
        }

        window.onresize = function (evt) {
            resize();
        }
    </script>
</body>
</html>
